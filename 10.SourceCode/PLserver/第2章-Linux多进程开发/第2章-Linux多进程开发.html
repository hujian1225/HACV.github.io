<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ç¬¬2ç« -Linuxå¤šè¿›ç¨‹å¼€å‘ | HACV</title>
    <meta name="description" content="Personal Blog Website">
    <link rel="icon" href="/images/photo.jpg">
  <link rel="manifest" href="/images/photo.jpg">
  <link rel="apple-touch-icon" href="/images/photo.jpg">
  <meta http-quiv="pragma" cotent="no-cache">
  <meta http-quiv="pragma" cotent="no-cache,must-revalidate">
  <meta http-quiv="expires" cotent="0">
    
    <link rel="preload" href="/assets/css/0.styles.0dbae9ec.css" as="style"><link rel="preload" href="/assets/js/app.a81bfa9c.js" as="script"><link rel="preload" href="/assets/js/9.80747d9d.js" as="script"><link rel="prefetch" href="/assets/js/10.705b2b8a.js"><link rel="prefetch" href="/assets/js/11.04ef285c.js"><link rel="prefetch" href="/assets/js/12.365e1e3a.js"><link rel="prefetch" href="/assets/js/13.fabde4c7.js"><link rel="prefetch" href="/assets/js/14.31e1d5f5.js"><link rel="prefetch" href="/assets/js/15.8cca7817.js"><link rel="prefetch" href="/assets/js/16.47c67535.js"><link rel="prefetch" href="/assets/js/17.b820a4ef.js"><link rel="prefetch" href="/assets/js/18.4ed533f0.js"><link rel="prefetch" href="/assets/js/19.0fa0a43d.js"><link rel="prefetch" href="/assets/js/2.95a53ad7.js"><link rel="prefetch" href="/assets/js/20.32f57824.js"><link rel="prefetch" href="/assets/js/21.0c52b7a2.js"><link rel="prefetch" href="/assets/js/22.9178aa59.js"><link rel="prefetch" href="/assets/js/23.31e494da.js"><link rel="prefetch" href="/assets/js/24.77aaf480.js"><link rel="prefetch" href="/assets/js/25.2b68b733.js"><link rel="prefetch" href="/assets/js/26.1c547ea2.js"><link rel="prefetch" href="/assets/js/27.eee865cf.js"><link rel="prefetch" href="/assets/js/28.505533a3.js"><link rel="prefetch" href="/assets/js/29.edb19fb2.js"><link rel="prefetch" href="/assets/js/3.806d10db.js"><link rel="prefetch" href="/assets/js/30.cdb506ac.js"><link rel="prefetch" href="/assets/js/31.511f62fa.js"><link rel="prefetch" href="/assets/js/32.8a7b2eb5.js"><link rel="prefetch" href="/assets/js/33.0b24332c.js"><link rel="prefetch" href="/assets/js/34.b69f822c.js"><link rel="prefetch" href="/assets/js/35.85661fc5.js"><link rel="prefetch" href="/assets/js/36.0105cfaf.js"><link rel="prefetch" href="/assets/js/37.4dd54028.js"><link rel="prefetch" href="/assets/js/38.7f1472cd.js"><link rel="prefetch" href="/assets/js/39.2d21663d.js"><link rel="prefetch" href="/assets/js/4.84efee75.js"><link rel="prefetch" href="/assets/js/40.69cf5802.js"><link rel="prefetch" href="/assets/js/41.4ff1c998.js"><link rel="prefetch" href="/assets/js/42.c52852b5.js"><link rel="prefetch" href="/assets/js/43.3ff64477.js"><link rel="prefetch" href="/assets/js/44.31f4e21d.js"><link rel="prefetch" href="/assets/js/45.9c06b96f.js"><link rel="prefetch" href="/assets/js/46.51488f7e.js"><link rel="prefetch" href="/assets/js/47.18e7017b.js"><link rel="prefetch" href="/assets/js/48.829d4342.js"><link rel="prefetch" href="/assets/js/49.ab43c61f.js"><link rel="prefetch" href="/assets/js/5.957a1c0b.js"><link rel="prefetch" href="/assets/js/50.66eafa1e.js"><link rel="prefetch" href="/assets/js/51.bf7fd61c.js"><link rel="prefetch" href="/assets/js/52.42f83a71.js"><link rel="prefetch" href="/assets/js/53.d429cef6.js"><link rel="prefetch" href="/assets/js/54.b495c746.js"><link rel="prefetch" href="/assets/js/55.17fd4493.js"><link rel="prefetch" href="/assets/js/56.1ee1c7b8.js"><link rel="prefetch" href="/assets/js/57.dd1b3303.js"><link rel="prefetch" href="/assets/js/58.37b0dbdc.js"><link rel="prefetch" href="/assets/js/59.b91cc5bc.js"><link rel="prefetch" href="/assets/js/6.414c0c2b.js"><link rel="prefetch" href="/assets/js/60.4e03235a.js"><link rel="prefetch" href="/assets/js/61.cf471e16.js"><link rel="prefetch" href="/assets/js/62.1a567d01.js"><link rel="prefetch" href="/assets/js/63.1de4bd57.js"><link rel="prefetch" href="/assets/js/64.cbb9ddaa.js"><link rel="prefetch" href="/assets/js/65.28421b63.js"><link rel="prefetch" href="/assets/js/66.0ddbb992.js"><link rel="prefetch" href="/assets/js/67.9e327af1.js"><link rel="prefetch" href="/assets/js/68.71848943.js"><link rel="prefetch" href="/assets/js/69.7e4d5f48.js"><link rel="prefetch" href="/assets/js/7.d08cb07f.js"><link rel="prefetch" href="/assets/js/70.974ce1ff.js"><link rel="prefetch" href="/assets/js/71.0c462743.js"><link rel="prefetch" href="/assets/js/72.20acc35f.js"><link rel="prefetch" href="/assets/js/73.96d91030.js"><link rel="prefetch" href="/assets/js/74.b65f3820.js"><link rel="prefetch" href="/assets/js/75.44f0174c.js"><link rel="prefetch" href="/assets/js/76.8deefff4.js"><link rel="prefetch" href="/assets/js/77.ee0b83a6.js"><link rel="prefetch" href="/assets/js/78.e5d70d11.js"><link rel="prefetch" href="/assets/js/79.ea72eaf5.js"><link rel="prefetch" href="/assets/js/8.4d0d1a66.js"><link rel="prefetch" href="/assets/js/80.ae5d94ea.js"><link rel="prefetch" href="/assets/js/81.7df9bcb6.js"><link rel="prefetch" href="/assets/js/82.568f1f27.js"><link rel="prefetch" href="/assets/js/83.69221a18.js"><link rel="prefetch" href="/assets/js/84.33a27b74.js"><link rel="prefetch" href="/assets/js/85.5f5d1f4f.js"><link rel="prefetch" href="/assets/js/86.f580acb1.js"><link rel="prefetch" href="/assets/js/87.a375d988.js"><link rel="prefetch" href="/assets/js/88.c1d002d8.js"><link rel="prefetch" href="/assets/js/89.7944c5e6.js"><link rel="prefetch" href="/assets/js/90.621c1398.js"><link rel="prefetch" href="/assets/js/91.7ccb419d.js"><link rel="prefetch" href="/assets/js/92.b3e0968b.js"><link rel="prefetch" href="/assets/js/93.7da8599a.js"><link rel="prefetch" href="/assets/js/94.02a46af6.js"><link rel="prefetch" href="/assets/js/95.0c4fcc1d.js"><link rel="prefetch" href="/assets/js/96.b43d80a9.js"><link rel="prefetch" href="/assets/js/97.941f4f78.js"><link rel="prefetch" href="/assets/js/98.199606a6.js"><link rel="prefetch" href="/assets/js/99.84613645.js">
    <link rel="stylesheet" href="/assets/css/0.styles.0dbae9ec.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">HACV</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/07.InternalSkill/" class="nav-link">â­ï¸ç¡¬ä»¶</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">ğŸ”‹è½¯ä»¶</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/02.DataStructureAndAlgorithm/" class="nav-link">ğŸ¾æ•°æ®ç»“æ„å’Œç®—æ³•</a></li><li class="dropdown-item"><!----> <a href="/03.OS/" class="nav-link">ğŸ’»æ“ä½œç³»ç»Ÿ</a></li><li class="dropdown-item"><!----> <a href="/04.Net/" class="nav-link">â˜ï¸è®¡ç®—æœºç½‘ç»œ</a></li><li class="dropdown-item"><!----> <a href="/05.SE/" class="nav-link">âœ…è½¯ä»¶å·¥ç¨‹</a></li></ul></div></div><div class="nav-item"><a href="/06.SQL/" class="nav-link">âš¡ï¸æ•°æ®åº“</a></div><div class="nav-item"><a href="/08.Tools/" class="nav-link">âš™ï¸å·¥å…·</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">ğŸš€è¯­è¨€</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/09.Language/Cpp/" class="nav-link">â­ï¸C++</a></li><li class="dropdown-item"><!----> <a href="/09.Language/Java/" class="nav-link">â˜•ï¸Java</a></li></ul></div></div><div class="nav-item"><a href="/10.SourceCode/" class="nav-link router-link-active">â­ï¸æºç å‰–æ</a></div><div class="nav-item"><a href="https://github.com/HACV" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/07.InternalSkill/" class="nav-link">â­ï¸ç¡¬ä»¶</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">ğŸ”‹è½¯ä»¶</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/02.DataStructureAndAlgorithm/" class="nav-link">ğŸ¾æ•°æ®ç»“æ„å’Œç®—æ³•</a></li><li class="dropdown-item"><!----> <a href="/03.OS/" class="nav-link">ğŸ’»æ“ä½œç³»ç»Ÿ</a></li><li class="dropdown-item"><!----> <a href="/04.Net/" class="nav-link">â˜ï¸è®¡ç®—æœºç½‘ç»œ</a></li><li class="dropdown-item"><!----> <a href="/05.SE/" class="nav-link">âœ…è½¯ä»¶å·¥ç¨‹</a></li></ul></div></div><div class="nav-item"><a href="/06.SQL/" class="nav-link">âš¡ï¸æ•°æ®åº“</a></div><div class="nav-item"><a href="/08.Tools/" class="nav-link">âš™ï¸å·¥å…·</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">ğŸš€è¯­è¨€</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/09.Language/Cpp/" class="nav-link">â­ï¸C++</a></li><li class="dropdown-item"><!----> <a href="/09.Language/Java/" class="nav-link">â˜•ï¸Java</a></li></ul></div></div><div class="nav-item"><a href="/10.SourceCode/" class="nav-link router-link-active">â­ï¸æºç å‰–æ</a></div><div class="nav-item"><a href="https://github.com/HACV" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>ç¬¬2ç« -Linuxå¤šè¿›ç¨‹å¼€å‘</span> <!----></p> <ul class="sidebar-group-items"></ul></div></li></ul> </div> <div class="page"> <div class="content"><h3 id="ç¬¬2ç« -linuxå¤šè¿›ç¨‹å¼€å‘"><a href="#ç¬¬2ç« -linuxå¤šè¿›ç¨‹å¼€å‘" class="header-anchor">#</a> ç¬¬2ç« -Linuxå¤šè¿›ç¨‹å¼€å‘</h3> <h3 id="_01-è¿›ç¨‹æ¦‚è¿°"><a href="#_01-è¿›ç¨‹æ¦‚è¿°" class="header-anchor">#</a> 01-è¿›ç¨‹æ¦‚è¿°</h3> <img src="/assets/img/01.ç¨‹åºå’Œè¿›ç¨‹.c31a0c29.png"> <h3 id="_02-è¿›ç¨‹çŠ¶æ€è½¬æ¢"><a href="#_02-è¿›ç¨‹çŠ¶æ€è½¬æ¢" class="header-anchor">#</a> 02-è¿›ç¨‹çŠ¶æ€è½¬æ¢</h3> <h3 id="_03-è¿›ç¨‹åˆ›å»º"><a href="#_03-è¿›ç¨‹åˆ›å»º" class="header-anchor">#</a> 03-è¿›ç¨‹åˆ›å»º</h3> <ul><li>fork.c</li></ul> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">/*
    #include &lt;sys/types.h&gt;
    #include &lt;unistd.h&gt;

    pid_t fork(void);
        å‡½æ•°çš„ä½œç”¨ï¼šç”¨äºåˆ›å»ºå­è¿›ç¨‹ã€‚
        è¿”å›å€¼ï¼š
            fork()çš„è¿”å›å€¼ä¼šè¿”å›ä¸¤æ¬¡ã€‚ä¸€æ¬¡æ˜¯åœ¨çˆ¶è¿›ç¨‹ä¸­ï¼Œä¸€æ¬¡æ˜¯åœ¨å­è¿›ç¨‹ä¸­ã€‚
            åœ¨çˆ¶è¿›ç¨‹ä¸­è¿”å›åˆ›å»ºçš„å­è¿›ç¨‹çš„ID,
            åœ¨å­è¿›ç¨‹ä¸­è¿”å›0
            å¦‚ä½•åŒºåˆ†çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ï¼šé€šè¿‡forkçš„è¿”å›å€¼ã€‚
            åœ¨çˆ¶è¿›ç¨‹ä¸­è¿”å›-1ï¼Œè¡¨ç¤ºåˆ›å»ºå­è¿›ç¨‹å¤±è´¥ï¼Œå¹¶ä¸”è®¾ç½®errno

        çˆ¶å­è¿›ç¨‹ä¹‹é—´çš„å…³ç³»ï¼š
        åŒºåˆ«ï¼š
            1.fork()å‡½æ•°çš„è¿”å›å€¼ä¸åŒ
                çˆ¶è¿›ç¨‹ä¸­: &gt;0 è¿”å›çš„å­è¿›ç¨‹çš„ID
                å­è¿›ç¨‹ä¸­: =0
            2.pcbä¸­çš„ä¸€äº›æ•°æ®
                å½“å‰çš„è¿›ç¨‹çš„id pid
                å½“å‰çš„è¿›ç¨‹çš„çˆ¶è¿›ç¨‹çš„id ppid
                ä¿¡å·é›†

        å…±åŒç‚¹ï¼š
            æŸäº›çŠ¶æ€ä¸‹ï¼šå­è¿›ç¨‹åˆšè¢«åˆ›å»ºå‡ºæ¥ï¼Œè¿˜æ²¡æœ‰æ‰§è¡Œä»»ä½•çš„å†™æ•°æ®çš„æ“ä½œ
                - ç”¨æˆ·åŒºçš„æ•°æ®
                - æ–‡ä»¶æè¿°ç¬¦è¡¨
        
        çˆ¶å­è¿›ç¨‹å¯¹å˜é‡æ˜¯ä¸æ˜¯å…±äº«çš„ï¼Ÿ
            - åˆšå¼€å§‹çš„æ—¶å€™ï¼Œæ˜¯ä¸€æ ·çš„ï¼Œå…±äº«çš„ã€‚å¦‚æœä¿®æ”¹äº†æ•°æ®ï¼Œä¸å…±äº«äº†ã€‚
            - è¯»æ—¶å…±äº«ï¼ˆå­è¿›ç¨‹è¢«åˆ›å»ºï¼Œä¸¤ä¸ªè¿›ç¨‹æ²¡æœ‰åšä»»ä½•çš„å†™çš„æ“ä½œï¼‰ï¼Œå†™æ—¶æ‹·è´ã€‚
        
*/</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

    <span class="token comment">// åˆ›å»ºå­è¿›ç¨‹</span>
    <span class="token class-name">pid_t</span> pid <span class="token operator">=</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// åˆ¤æ–­æ˜¯çˆ¶è¿›ç¨‹è¿˜æ˜¯å­è¿›ç¨‹</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>pid <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// printf(&quot;pid : %d\n&quot;, pid);</span>
        <span class="token comment">// å¦‚æœå¤§äº0ï¼Œè¿”å›çš„æ˜¯åˆ›å»ºçš„å­è¿›ç¨‹çš„è¿›ç¨‹å·ï¼Œå½“å‰æ˜¯çˆ¶è¿›ç¨‹</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;i am parent process, pid : %d, ppid : %d\n&quot;</span><span class="token punctuation">,</span> <span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getppid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;parent num : %d\n&quot;</span><span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>
        num <span class="token operator">+=</span> <span class="token number">10</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;parent num += 10 : %d\n&quot;</span><span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>pid <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// å½“å‰æ˜¯å­è¿›ç¨‹</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;i am child process, pid : %d, ppid : %d\n&quot;</span><span class="token punctuation">,</span> <span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">getppid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;child num : %d\n&quot;</span><span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>
        num <span class="token operator">+=</span> <span class="token number">100</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;child num += 100 : %d\n&quot;</span><span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// forå¾ªç¯</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;i : %d , pid : %d\n&quot;</span><span class="token punctuation">,</span> i <span class="token punctuation">,</span> <span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/*
å®é™…ä¸Šï¼Œæ›´å‡†ç¡®æ¥è¯´ï¼ŒLinux çš„ fork() ä½¿ç”¨æ˜¯é€šè¿‡å†™æ—¶æ‹·è´ (copy- on-write) å®ç°ã€‚
å†™æ—¶æ‹·è´æ˜¯ä¸€ç§å¯ä»¥æ¨è¿Ÿç”šè‡³é¿å…æ‹·è´æ•°æ®çš„æŠ€æœ¯ã€‚
å†…æ ¸æ­¤æ—¶å¹¶ä¸å¤åˆ¶æ•´ä¸ªè¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼Œè€Œæ˜¯è®©çˆ¶å­è¿›ç¨‹å…±äº«åŒä¸€ä¸ªåœ°å€ç©ºé—´ã€‚
åªç”¨åœ¨éœ€è¦å†™å…¥çš„æ—¶å€™æ‰ä¼šå¤åˆ¶åœ°å€ç©ºé—´ï¼Œä»è€Œä½¿å„ä¸ªè¿›è¡Œæ‹¥æœ‰å„è‡ªçš„åœ°å€ç©ºé—´ã€‚
ä¹Ÿå°±æ˜¯è¯´ï¼Œèµ„æºçš„å¤åˆ¶æ˜¯åœ¨éœ€è¦å†™å…¥çš„æ—¶å€™æ‰ä¼šè¿›è¡Œï¼Œåœ¨æ­¤ä¹‹å‰ï¼Œåªæœ‰ä»¥åªè¯»æ–¹å¼å…±äº«ã€‚
æ³¨æ„ï¼šforkä¹‹åçˆ¶å­è¿›ç¨‹å…±äº«æ–‡ä»¶ï¼Œ
forkäº§ç”Ÿçš„å­è¿›ç¨‹ä¸çˆ¶è¿›ç¨‹ç›¸åŒçš„æ–‡ä»¶æ–‡ä»¶æè¿°ç¬¦æŒ‡å‘ç›¸åŒçš„æ–‡ä»¶è¡¨ï¼Œå¼•ç”¨è®¡æ•°å¢åŠ ï¼Œå…±äº«æ–‡ä»¶åç§»æŒ‡é’ˆã€‚
*/</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br></div></div><h3 id="_04-çˆ¶å­è¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´æƒ…å†µ"><a href="#_04-çˆ¶å­è¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´æƒ…å†µ" class="header-anchor">#</a> 04-çˆ¶å­è¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´æƒ…å†µ</h3> <h3 id="_05-çˆ¶å­è¿›ç¨‹å…³ç³»åŠgdbå¤šè¿›ç¨‹è°ƒè¯•"><a href="#_05-çˆ¶å­è¿›ç¨‹å…³ç³»åŠgdbå¤šè¿›ç¨‹è°ƒè¯•" class="header-anchor">#</a> 05-çˆ¶å­è¿›ç¨‹å…³ç³»åŠGDBå¤šè¿›ç¨‹è°ƒè¯•</h3> <ul><li>hello</li></ul> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;begin\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;æˆ‘æ˜¯çˆ¶è¿›ç¨‹ï¼špid = %d, ppid = %d\n&quot;</span><span class="token punctuation">,</span> <span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getppid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">int</span> i<span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;i = %d\n&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>

        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;æˆ‘æ˜¯å­è¿›ç¨‹ï¼špid = %d, ppid = %d\n&quot;</span><span class="token punctuation">,</span> <span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getppid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">int</span> j<span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;j = %d\n&quot;</span><span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h3 id="_06-execå‡½æ•°æ—"><a href="#_06-execå‡½æ•°æ—" class="header-anchor">#</a> 06-execå‡½æ•°æ—</h3> <h4 id="ã€1ã€execl-c"><a href="#ã€1ã€execl-c" class="header-anchor">#</a> ã€1ã€execl.c</h4> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">/*  
    #include &lt;unistd.h&gt;
    int execl(const char *path, const char *arg, ...);
        - å‚æ•°ï¼š
            - path:éœ€è¦æŒ‡å®šçš„æ‰§è¡Œçš„æ–‡ä»¶çš„è·¯å¾„æˆ–è€…åç§°
                a.out /home/nowcoder/a.out æ¨èä½¿ç”¨ç»å¯¹è·¯å¾„
                ./a.out hello world

            - arg:æ˜¯æ‰§è¡Œå¯æ‰§è¡Œæ–‡ä»¶æ‰€éœ€è¦çš„å‚æ•°åˆ—è¡¨
                ç¬¬ä¸€ä¸ªå‚æ•°ä¸€èˆ¬æ²¡æœ‰ä»€ä¹ˆä½œç”¨ï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œä¸€èˆ¬å†™çš„æ˜¯æ‰§è¡Œçš„ç¨‹åºçš„åç§°
                ä»ç¬¬äºŒä¸ªå‚æ•°å¼€å§‹å¾€åï¼Œå°±æ˜¯ç¨‹åºæ‰§è¡Œæ‰€éœ€è¦çš„çš„å‚æ•°åˆ—è¡¨ã€‚
                å‚æ•°æœ€åéœ€è¦ä»¥NULLç»“æŸï¼ˆå“¨å…µï¼‰

        - è¿”å›å€¼ï¼š
            åªæœ‰å½“è°ƒç”¨å¤±è´¥ï¼Œæ‰ä¼šæœ‰è¿”å›å€¼ï¼Œè¿”å›-1ï¼Œå¹¶ä¸”è®¾ç½®errno
            å¦‚æœè°ƒç”¨æˆåŠŸï¼Œæ²¡æœ‰è¿”å›å€¼ã€‚

*/</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>


    <span class="token comment">// åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œåœ¨å­è¿›ç¨‹ä¸­æ‰§è¡Œexecå‡½æ•°æ—ä¸­çš„å‡½æ•°</span>
    <span class="token class-name">pid_t</span> pid <span class="token operator">=</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>pid <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// çˆ¶è¿›ç¨‹</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;i am parent process, pid : %d\n&quot;</span><span class="token punctuation">,</span><span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>pid <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// å­è¿›ç¨‹</span>
        <span class="token comment">// execl(&quot;hello&quot;,&quot;hello&quot;,NULL);</span>

        <span class="token function">execl</span><span class="token punctuation">(</span><span class="token string">&quot;/bin/ps&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ps&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;aux&quot;</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;execl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;i am child process, pid : %d\n&quot;</span><span class="token punctuation">,</span> <span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;i = %d, pid = %d\n&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> <span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><h4 id="ã€2ã€execlp-c"><a href="#ã€2ã€execlp-c" class="header-anchor">#</a> ã€2ã€execlp.c</h4> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">/*  
    #include &lt;unistd.h&gt;
    int execlp(const char *file, const char *arg, ... );
        - ä¼šåˆ°ç¯å¢ƒå˜é‡ä¸­æŸ¥æ‰¾æŒ‡å®šçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¦‚æœæ‰¾åˆ°äº†å°±æ‰§è¡Œï¼Œæ‰¾ä¸åˆ°å°±æ‰§è¡Œä¸æˆåŠŸã€‚
        - å‚æ•°ï¼š
            - file:éœ€è¦æ‰§è¡Œçš„å¯æ‰§è¡Œæ–‡ä»¶çš„æ–‡ä»¶å
                a.out
                ps

            - arg:æ˜¯æ‰§è¡Œå¯æ‰§è¡Œæ–‡ä»¶æ‰€éœ€è¦çš„å‚æ•°åˆ—è¡¨
                ç¬¬ä¸€ä¸ªå‚æ•°ä¸€èˆ¬æ²¡æœ‰ä»€ä¹ˆä½œç”¨ï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œä¸€èˆ¬å†™çš„æ˜¯æ‰§è¡Œçš„ç¨‹åºçš„åç§°
                ä»ç¬¬äºŒä¸ªå‚æ•°å¼€å§‹å¾€åï¼Œå°±æ˜¯ç¨‹åºæ‰§è¡Œæ‰€éœ€è¦çš„çš„å‚æ•°åˆ—è¡¨ã€‚
                å‚æ•°æœ€åéœ€è¦ä»¥NULLç»“æŸï¼ˆå“¨å…µï¼‰

        - è¿”å›å€¼ï¼š
            åªæœ‰å½“è°ƒç”¨å¤±è´¥ï¼Œæ‰ä¼šæœ‰è¿”å›å€¼ï¼Œè¿”å›-1ï¼Œå¹¶ä¸”è®¾ç½®errno
            å¦‚æœè°ƒç”¨æˆåŠŸï¼Œæ²¡æœ‰è¿”å›å€¼ã€‚


        int execv(const char *path, char *const argv[]);
        argvæ˜¯éœ€è¦çš„å‚æ•°çš„ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„
        char * argv[] = {&quot;ps&quot;, &quot;aux&quot;, NULL};
        execv(&quot;/bin/ps&quot;, argv);

        int execve(const char *filename, char *const argv[], char *const envp[]);
        char * envp[] = {&quot;/home/nowcoder&quot;, &quot;/home/bbb&quot;, &quot;/home/aaa&quot;};


*/</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>


    <span class="token comment">// åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œåœ¨å­è¿›ç¨‹ä¸­æ‰§è¡Œexecå‡½æ•°æ—ä¸­çš„å‡½æ•°</span>
    <span class="token class-name">pid_t</span> pid <span class="token operator">=</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>pid <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// çˆ¶è¿›ç¨‹</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;i am parent process, pid : %d\n&quot;</span><span class="token punctuation">,</span><span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>pid <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// å­è¿›ç¨‹</span>
        <span class="token function">execlp</span><span class="token punctuation">(</span><span class="token string">&quot;ps&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ps&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;aux&quot;</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;i am child process, pid : %d\n&quot;</span><span class="token punctuation">,</span> <span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;i = %d, pid = %d\n&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> <span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div><h4 id="ã€3ã€hello-c"><a href="#ã€3ã€hello-c" class="header-anchor">#</a> ã€3ã€hello.c</h4> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;hello, world\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_07-è¿›ç¨‹é€€å‡ºå’Œå­¤å„¿è¿›ç¨‹å’Œåƒµå°¸è¿›ç¨‹"><a href="#_07-è¿›ç¨‹é€€å‡ºå’Œå­¤å„¿è¿›ç¨‹å’Œåƒµå°¸è¿›ç¨‹" class="header-anchor">#</a> 07-è¿›ç¨‹é€€å‡ºå’Œå­¤å„¿è¿›ç¨‹å’Œåƒµå°¸è¿›ç¨‹</h3> <h4 id="ã€1ã€exit-c"><a href="#ã€1ã€exit-c" class="header-anchor">#</a> ã€1ã€exit.c</h4> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">/*
    #include &lt;stdlib.h&gt;
    void exit(int status);

    #include &lt;unistd.h&gt;
    void _exit(int status);

    statuså‚æ•°ï¼šæ˜¯è¿›ç¨‹é€€å‡ºæ—¶çš„ä¸€ä¸ªçŠ¶æ€ä¿¡æ¯ã€‚çˆ¶è¿›ç¨‹å›æ”¶å­è¿›ç¨‹èµ„æºçš„æ—¶å€™å¯ä»¥è·å–åˆ°ã€‚
*/</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;hello\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// exit(0);</span>
    <span class="token function">_exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h4 id="ã€2ã€orphan-c"><a href="#ã€2ã€orphan-c" class="header-anchor">#</a> ã€2ã€orphan.c</h4> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// åˆ›å»ºå­è¿›ç¨‹</span>
    <span class="token class-name">pid_t</span> pid <span class="token operator">=</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// åˆ¤æ–­æ˜¯çˆ¶è¿›ç¨‹è¿˜æ˜¯å­è¿›ç¨‹</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>pid <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;i am parent process, pid : %d, ppid : %d\n&quot;</span><span class="token punctuation">,</span> <span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getppid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>pid <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// å½“å‰æ˜¯å­è¿›ç¨‹</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;i am child process, pid : %d, ppid : %d\n&quot;</span><span class="token punctuation">,</span> <span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">getppid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       
    <span class="token punctuation">}</span>

    <span class="token comment">// forå¾ªç¯</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;i : %d , pid : %d\n&quot;</span><span class="token punctuation">,</span> i <span class="token punctuation">,</span> <span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h4 id="ã€3ã€zombie-c"><a href="#ã€3ã€zombie-c" class="header-anchor">#</a> ã€3ã€zombie.c</h4> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// åˆ›å»ºå­è¿›ç¨‹</span>
    <span class="token class-name">pid_t</span> pid <span class="token operator">=</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// åˆ¤æ–­æ˜¯çˆ¶è¿›ç¨‹è¿˜æ˜¯å­è¿›ç¨‹</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>pid <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;i am parent process, pid : %d, ppid : %d\n&quot;</span><span class="token punctuation">,</span> <span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getppid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>pid <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// å½“å‰æ˜¯å­è¿›ç¨‹</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;i am child process, pid : %d, ppid : %d\n&quot;</span><span class="token punctuation">,</span> <span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">getppid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       
    <span class="token punctuation">}</span>

    <span class="token comment">// forå¾ªç¯</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;i : %d , pid : %d\n&quot;</span><span class="token punctuation">,</span> i <span class="token punctuation">,</span> <span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h3 id="_08-waitå‡½æ•°"><a href="#_08-waitå‡½æ•°" class="header-anchor">#</a> 08.waitå‡½æ•°</h3> <h4 id="ã€1ã€wait-c"><a href="#ã€1ã€wait-c" class="header-anchor">#</a> ã€1ã€wait.c</h4> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">/*
    #include &lt;sys/types.h&gt;
    #include &lt;sys/wait.h&gt;
    pid_t wait(int *wstatus);
        åŠŸèƒ½ï¼šç­‰å¾…ä»»æ„ä¸€ä¸ªå­è¿›ç¨‹ç»“æŸï¼Œå¦‚æœä»»æ„ä¸€ä¸ªå­è¿›ç¨‹ç»“æŸäº†ï¼Œæ¬¡å‡½æ•°ä¼šå›æ”¶å­è¿›ç¨‹çš„èµ„æºã€‚
        å‚æ•°ï¼šint *wstatus
            è¿›ç¨‹é€€å‡ºæ—¶çš„çŠ¶æ€ä¿¡æ¯ï¼Œä¼ å…¥çš„æ˜¯ä¸€ä¸ªintç±»å‹çš„åœ°å€ï¼Œä¼ å‡ºå‚æ•°ã€‚
        è¿”å›å€¼ï¼š
            - æˆåŠŸï¼šè¿”å›è¢«å›æ”¶çš„å­è¿›ç¨‹çš„id
            - å¤±è´¥ï¼š-1 (æ‰€æœ‰çš„å­è¿›ç¨‹éƒ½ç»“æŸï¼Œè°ƒç”¨å‡½æ•°å¤±è´¥)

    è°ƒç”¨waitå‡½æ•°çš„è¿›ç¨‹ä¼šè¢«æŒ‚èµ·ï¼ˆé˜»å¡ï¼‰ï¼Œç›´åˆ°å®ƒçš„ä¸€ä¸ªå­è¿›ç¨‹é€€å‡ºæˆ–è€…æ”¶åˆ°ä¸€ä¸ªä¸èƒ½è¢«å¿½ç•¥çš„ä¿¡å·æ—¶æ‰è¢«å”¤é†’ï¼ˆç›¸å½“äºç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼‰
    å¦‚æœæ²¡æœ‰å­è¿›ç¨‹äº†ï¼Œå‡½æ•°ç«‹åˆ»è¿”å›ï¼Œè¿”å›-1ï¼›å¦‚æœå­è¿›ç¨‹éƒ½å·²ç»ç»“æŸäº†ï¼Œä¹Ÿä¼šç«‹å³è¿”å›ï¼Œè¿”å›-1.

*/</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/wait.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>


<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// æœ‰ä¸€ä¸ªçˆ¶è¿›ç¨‹ï¼Œåˆ›å»º5ä¸ªå­è¿›ç¨‹ï¼ˆå…„å¼Ÿï¼‰</span>
    <span class="token class-name">pid_t</span> pid<span class="token punctuation">;</span>

    <span class="token comment">// åˆ›å»º5ä¸ªå­è¿›ç¨‹</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        pid <span class="token operator">=</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>pid <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>pid <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// çˆ¶è¿›ç¨‹</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;parent, pid = %d\n&quot;</span><span class="token punctuation">,</span> <span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// int ret = wait(NULL);</span>
            <span class="token keyword">int</span> st<span class="token punctuation">;</span>
            <span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">wait</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>st<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">WIFEXITED</span><span class="token punctuation">(</span>st<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// æ˜¯ä¸æ˜¯æ­£å¸¸é€€å‡º</span>
                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;é€€å‡ºçš„çŠ¶æ€ç ï¼š%d\n&quot;</span><span class="token punctuation">,</span> <span class="token function">WEXITSTATUS</span><span class="token punctuation">(</span>st<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">WIFSIGNALED</span><span class="token punctuation">(</span>st<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// æ˜¯ä¸æ˜¯å¼‚å¸¸ç»ˆæ­¢</span>
                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;è¢«å“ªä¸ªä¿¡å·å¹²æ‰äº†ï¼š%d\n&quot;</span><span class="token punctuation">,</span> <span class="token function">WTERMSIG</span><span class="token punctuation">(</span>st<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;child die, pid = %d\n&quot;</span><span class="token punctuation">,</span> ret<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>pid <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// å­è¿›ç¨‹</span>
         <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;child, pid = %d\n&quot;</span><span class="token punctuation">,</span><span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
            <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       
         <span class="token punctuation">}</span>

        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// exit(0)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br></div></div><h3 id="_09-waitpidå‡½æ•°"><a href="#_09-waitpidå‡½æ•°" class="header-anchor">#</a> 09.waitpidå‡½æ•°</h3> <h4 id="ã€1ã€waitpid-c"><a href="#ã€1ã€waitpid-c" class="header-anchor">#</a> ã€1ã€waitpid.c</h4> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">/*
    #include &lt;sys/types.h&gt;
    #include &lt;sys/wait.h&gt;
    pid_t waitpid(pid_t pid, int *wstatus, int options);
        åŠŸèƒ½ï¼šå›æ”¶æŒ‡å®šè¿›ç¨‹å·çš„å­è¿›ç¨‹ï¼Œå¯ä»¥è®¾ç½®æ˜¯å¦é˜»å¡ã€‚
        å‚æ•°ï¼š
            - pid:
                pid &gt; 0 : æŸä¸ªå­è¿›ç¨‹çš„pid
                pid = 0 : å›æ”¶å½“å‰è¿›ç¨‹ç»„çš„æ‰€æœ‰å­è¿›ç¨‹    
                pid = -1 : å›æ”¶æ‰€æœ‰çš„å­è¿›ç¨‹ï¼Œç›¸å½“äº wait()  ï¼ˆæœ€å¸¸ç”¨ï¼‰
                pid &lt; -1 : æŸä¸ªè¿›ç¨‹ç»„çš„ç»„idçš„ç»å¯¹å€¼ï¼Œå›æ”¶æŒ‡å®šè¿›ç¨‹ç»„ä¸­çš„å­è¿›ç¨‹
            - optionsï¼šè®¾ç½®é˜»å¡æˆ–è€…éé˜»å¡
                0 : é˜»å¡
                WNOHANG : éé˜»å¡
            - è¿”å›å€¼ï¼š
                &gt; 0 : è¿”å›å­è¿›ç¨‹çš„id
                = 0 : options=WNOHANG, è¡¨ç¤ºè¿˜æœ‰å­è¿›ç¨‹æˆ–è€…
                = -1 ï¼šé”™è¯¯ï¼Œæˆ–è€…æ²¡æœ‰å­è¿›ç¨‹äº†
*/</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/wait.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// æœ‰ä¸€ä¸ªçˆ¶è¿›ç¨‹ï¼Œåˆ›å»º5ä¸ªå­è¿›ç¨‹ï¼ˆå…„å¼Ÿï¼‰</span>
    <span class="token class-name">pid_t</span> pid<span class="token punctuation">;</span>

    <span class="token comment">// åˆ›å»º5ä¸ªå­è¿›ç¨‹</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        pid <span class="token operator">=</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>pid <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>pid <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// çˆ¶è¿›ç¨‹</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;parent, pid = %d\n&quot;</span><span class="token punctuation">,</span> <span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">int</span> st<span class="token punctuation">;</span>
            <span class="token comment">// int ret = waitpid(-1, &amp;st, 0);</span>
            <span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">waitpid</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>st<span class="token punctuation">,</span> WNOHANG<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// è¯´æ˜è¿˜æœ‰å­è¿›ç¨‹å­˜åœ¨</span>
                <span class="token keyword">continue</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">WIFEXITED</span><span class="token punctuation">(</span>st<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// æ˜¯ä¸æ˜¯æ­£å¸¸é€€å‡º</span>
                    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;é€€å‡ºçš„çŠ¶æ€ç ï¼š%d\n&quot;</span><span class="token punctuation">,</span> <span class="token function">WEXITSTATUS</span><span class="token punctuation">(</span>st<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">WIFSIGNALED</span><span class="token punctuation">(</span>st<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// æ˜¯ä¸æ˜¯å¼‚å¸¸ç»ˆæ­¢</span>
                    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;è¢«å“ªä¸ªä¿¡å·å¹²æ‰äº†ï¼š%d\n&quot;</span><span class="token punctuation">,</span> <span class="token function">WTERMSIG</span><span class="token punctuation">(</span>st<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;child die, pid = %d\n&quot;</span><span class="token punctuation">,</span> ret<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
           
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>pid <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// å­è¿›ç¨‹</span>
         <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;child, pid = %d\n&quot;</span><span class="token punctuation">,</span><span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
            <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       
         <span class="token punctuation">}</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br></div></div><h3 id="_10-è¿›ç¨‹é—´é€šä¿¡ç®€ä»‹"><a href="#_10-è¿›ç¨‹é—´é€šä¿¡ç®€ä»‹" class="header-anchor">#</a> 10.è¿›ç¨‹é—´é€šä¿¡ç®€ä»‹</h3> <h3 id="_11-åŒ¿åç®¡é“æ¦‚è¿°"><a href="#_11-åŒ¿åç®¡é“æ¦‚è¿°" class="header-anchor">#</a> 11.åŒ¿åç®¡é“æ¦‚è¿°</h3> <h3 id="_12-çˆ¶å­è¿›ç¨‹é€šè¿‡åŒ¿åç®¡é“é€šä¿¡"><a href="#_12-çˆ¶å­è¿›ç¨‹é€šè¿‡åŒ¿åç®¡é“é€šä¿¡" class="header-anchor">#</a> 12.çˆ¶å­è¿›ç¨‹é€šè¿‡åŒ¿åç®¡é“é€šä¿¡</h3> <h4 id="_1-fpathconf-c"><a href="#_1-fpathconf-c" class="header-anchor">#</a> 1.fpathconf.c</h4> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">int</span> pipefd<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">pipe</span><span class="token punctuation">(</span>pipefd<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// è·å–ç®¡é“çš„å¤§å°</span>
    <span class="token keyword">long</span> size <span class="token operator">=</span> <span class="token function">fpathconf</span><span class="token punctuation">(</span>pipefd<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> _PC_PIPE_BUF<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;pipe size : %ld\n&quot;</span><span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h4 id="_2-pipe-c"><a href="#_2-pipe-c" class="header-anchor">#</a> 2.pipe.c</h4> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">/*
    #include &lt;unistd.h&gt;
    int pipe(int pipefd[2]);
        åŠŸèƒ½ï¼šåˆ›å»ºä¸€ä¸ªåŒ¿åç®¡é“ï¼Œç”¨æ¥è¿›ç¨‹é—´é€šä¿¡ã€‚
        å‚æ•°ï¼šint pipefd[2] è¿™ä¸ªæ•°ç»„æ˜¯ä¸€ä¸ªä¼ å‡ºå‚æ•°ã€‚
            pipefd[0] å¯¹åº”çš„æ˜¯ç®¡é“çš„è¯»ç«¯
            pipefd[1] å¯¹åº”çš„æ˜¯ç®¡é“çš„å†™ç«¯
        è¿”å›å€¼ï¼š
            æˆåŠŸ 0
            å¤±è´¥ -1

    ç®¡é“é»˜è®¤æ˜¯é˜»å¡çš„ï¼šå¦‚æœç®¡é“ä¸­æ²¡æœ‰æ•°æ®ï¼Œreadé˜»å¡ï¼Œå¦‚æœç®¡é“æ»¡äº†ï¼Œwriteé˜»å¡

    æ³¨æ„ï¼šåŒ¿åç®¡é“åªèƒ½ç”¨äºå…·æœ‰å…³ç³»çš„è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ï¼ˆçˆ¶å­è¿›ç¨‹ï¼Œå…„å¼Ÿè¿›ç¨‹ï¼‰
*/</span>

<span class="token comment">// å­è¿›ç¨‹å‘é€æ•°æ®ç»™çˆ¶è¿›ç¨‹ï¼Œçˆ¶è¿›ç¨‹è¯»å–åˆ°æ•°æ®è¾“å‡º</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// åœ¨forkä¹‹å‰åˆ›å»ºç®¡é“</span>
    <span class="token keyword">int</span> pipefd<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">pipe</span><span class="token punctuation">(</span>pipefd<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;pipe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// åˆ›å»ºå­è¿›ç¨‹</span>
    <span class="token class-name">pid_t</span> pid <span class="token operator">=</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>pid <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// çˆ¶è¿›ç¨‹</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;i am parent process, pid : %d\n&quot;</span><span class="token punctuation">,</span> <span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// å…³é—­å†™ç«¯</span>
        <span class="token function">close</span><span class="token punctuation">(</span>pipefd<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// ä»ç®¡é“çš„è¯»å–ç«¯è¯»å–æ•°æ®</span>
        <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token function">read</span><span class="token punctuation">(</span>pipefd<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;parent recv : %s, pid : %d\n&quot;</span><span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token comment">// å‘ç®¡é“ä¸­å†™å…¥æ•°æ®</span>
            <span class="token comment">//char * str = &quot;hello,i am parent&quot;;</span>
            <span class="token comment">//write(pipefd[1], str, strlen(str));</span>
            <span class="token comment">//sleep(1);</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>pid <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// å­è¿›ç¨‹</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;i am child process, pid : %d\n&quot;</span><span class="token punctuation">,</span> <span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// å…³é—­è¯»ç«¯</span>
        <span class="token function">close</span><span class="token punctuation">(</span>pipefd<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// å‘ç®¡é“ä¸­å†™å…¥æ•°æ®</span>
            <span class="token keyword">char</span> <span class="token operator">*</span> str <span class="token operator">=</span> <span class="token string">&quot;hello,i am child&quot;</span><span class="token punctuation">;</span>
            <span class="token function">write</span><span class="token punctuation">(</span>pipefd<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> str<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//sleep(1);</span>

            <span class="token comment">// int len = read(pipefd[0], buf, sizeof(buf));</span>
            <span class="token comment">// printf(&quot;child recv : %s, pid : %d\n&quot;, buf, getpid());</span>
            <span class="token comment">// bzero(buf, 1024);</span>
        <span class="token punctuation">}</span>
        
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br></div></div><h3 id="_13-åŒ¿åç®¡é“é€šä¿¡æ¡ˆä¾‹"><a href="#_13-åŒ¿åç®¡é“é€šä¿¡æ¡ˆä¾‹" class="header-anchor">#</a> 13.åŒ¿åç®¡é“é€šä¿¡æ¡ˆä¾‹</h3> <h4 id="ã€1ã€parent-child-ipc-c"><a href="#ã€1ã€parent-child-ipc-c" class="header-anchor">#</a> ã€1ã€parent-child-ipc.c</h4> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">/*
    å®ç° ps aux | grep xxx çˆ¶å­è¿›ç¨‹é—´é€šä¿¡
    
    å­è¿›ç¨‹ï¼š ps aux, å­è¿›ç¨‹ç»“æŸåï¼Œå°†æ•°æ®å‘é€ç»™çˆ¶è¿›ç¨‹
    çˆ¶è¿›ç¨‹ï¼šè·å–åˆ°æ•°æ®ï¼Œè¿‡æ»¤
    pipe()
    execlp()
    å­è¿›ç¨‹å°†æ ‡å‡†è¾“å‡º stdout_fileno é‡å®šå‘åˆ°ç®¡é“çš„å†™ç«¯ã€‚  dup2
*/</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;wait.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// åˆ›å»ºä¸€ä¸ªç®¡é“</span>
    <span class="token keyword">int</span> fd<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">pipe</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;pipe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// åˆ›å»ºå­è¿›ç¨‹</span>
    <span class="token class-name">pid_t</span> pid <span class="token operator">=</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>pid <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// çˆ¶è¿›ç¨‹</span>
        <span class="token comment">// å…³é—­å†™ç«¯</span>
        <span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ä»ç®¡é“ä¸­è¯»å–</span>
        <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>len <span class="token operator">=</span> <span class="token function">read</span><span class="token punctuation">(</span>fd<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// è¿‡æ»¤æ•°æ®è¾“å‡º</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s&quot;</span><span class="token punctuation">,</span> buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">memset</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token function">wait</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>pid <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// å­è¿›ç¨‹</span>
        <span class="token comment">// å…³é—­è¯»ç«¯</span>
        <span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// æ–‡ä»¶æè¿°ç¬¦çš„é‡å®šå‘ stdout_fileno -&gt; fd[1]</span>
        <span class="token function">dup2</span><span class="token punctuation">(</span>fd<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> STDOUT_FILENO<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// æ‰§è¡Œ ps aux</span>
        <span class="token function">execlp</span><span class="token punctuation">(</span><span class="token string">&quot;ps&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ps&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;aux&quot;</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;execlp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;fork&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br></div></div><h3 id="_14-ç®¡é“çš„è¯»å†™ç‰¹ç‚¹å’Œç®¡é“è®¾ç½®ä¸ºéé˜»å¡"><a href="#_14-ç®¡é“çš„è¯»å†™ç‰¹ç‚¹å’Œç®¡é“è®¾ç½®ä¸ºéé˜»å¡" class="header-anchor">#</a> 14.ç®¡é“çš„è¯»å†™ç‰¹ç‚¹å’Œç®¡é“è®¾ç½®ä¸ºéé˜»å¡</h3> <h4 id="ã€ç®¡é“çš„è¯»å†™ç‰¹ç‚¹-txtã€"><a href="#ã€ç®¡é“çš„è¯»å†™ç‰¹ç‚¹-txtã€" class="header-anchor">#</a> ã€ç®¡é“çš„è¯»å†™ç‰¹ç‚¹.txtã€</h4> <div class="language-c line-numbers-mode"><pre class="language-c"><code>ç®¡é“çš„è¯»å†™ç‰¹ç‚¹ï¼š
ä½¿ç”¨ç®¡é“æ—¶ï¼Œéœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç§ç‰¹æ®Šçš„æƒ…å†µï¼ˆå‡è®¾éƒ½æ˜¯é˜»å¡I<span class="token operator">/</span>Oæ“ä½œï¼‰
<span class="token number">1.</span>æ‰€æœ‰çš„æŒ‡å‘ç®¡é“å†™ç«¯çš„æ–‡ä»¶æè¿°ç¬¦éƒ½å…³é—­äº†ï¼ˆç®¡é“å†™ç«¯å¼•ç”¨è®¡æ•°ä¸º<span class="token number">0</span>ï¼‰ï¼Œæœ‰è¿›ç¨‹ä»ç®¡é“çš„è¯»ç«¯
è¯»æ•°æ®ï¼Œé‚£ä¹ˆç®¡é“ä¸­å‰©ä½™çš„æ•°æ®è¢«è¯»å–ä»¥åï¼Œå†æ¬¡readä¼šè¿”å›<span class="token number">0</span>ï¼Œå°±åƒè¯»åˆ°æ–‡ä»¶æœ«å°¾ä¸€æ ·ã€‚

<span class="token number">2.</span>å¦‚æœæœ‰æŒ‡å‘ç®¡é“å†™ç«¯çš„æ–‡ä»¶æè¿°ç¬¦æ²¡æœ‰å…³é—­ï¼ˆç®¡é“çš„å†™ç«¯å¼•ç”¨è®¡æ•°å¤§äº<span class="token number">0</span>ï¼‰ï¼Œè€ŒæŒæœ‰ç®¡é“å†™ç«¯çš„è¿›ç¨‹
ä¹Ÿæ²¡æœ‰å¾€ç®¡é“ä¸­å†™æ•°æ®ï¼Œè¿™ä¸ªæ—¶å€™æœ‰è¿›ç¨‹ä»ç®¡é“ä¸­è¯»å–æ•°æ®ï¼Œé‚£ä¹ˆç®¡é“ä¸­å‰©ä½™çš„æ•°æ®è¢«è¯»å–åï¼Œ
å†æ¬¡readä¼šé˜»å¡ï¼Œç›´åˆ°ç®¡é“ä¸­æœ‰æ•°æ®å¯ä»¥è¯»äº†æ‰è¯»å–æ•°æ®å¹¶è¿”å›ã€‚

<span class="token number">3.</span>å¦‚æœæ‰€æœ‰æŒ‡å‘ç®¡é“è¯»ç«¯çš„æ–‡ä»¶æè¿°ç¬¦éƒ½å…³é—­äº†ï¼ˆç®¡é“çš„è¯»ç«¯å¼•ç”¨è®¡æ•°ä¸º<span class="token number">0</span>ï¼‰ï¼Œè¿™ä¸ªæ—¶å€™æœ‰è¿›ç¨‹
å‘ç®¡é“ä¸­å†™æ•°æ®ï¼Œé‚£ä¹ˆè¯¥è¿›ç¨‹ä¼šæ”¶åˆ°ä¸€ä¸ªä¿¡å·SIGPIPE<span class="token punctuation">,</span> é€šå¸¸ä¼šå¯¼è‡´è¿›ç¨‹å¼‚å¸¸ç»ˆæ­¢ã€‚

<span class="token number">4.</span>å¦‚æœæœ‰æŒ‡å‘ç®¡é“è¯»ç«¯çš„æ–‡ä»¶æè¿°ç¬¦æ²¡æœ‰å…³é—­ï¼ˆç®¡é“çš„è¯»ç«¯å¼•ç”¨è®¡æ•°å¤§äº<span class="token number">0</span>ï¼‰ï¼Œè€ŒæŒæœ‰ç®¡é“è¯»ç«¯çš„è¿›ç¨‹
ä¹Ÿæ²¡æœ‰ä»ç®¡é“ä¸­è¯»æ•°æ®ï¼Œè¿™æ—¶æœ‰è¿›ç¨‹å‘ç®¡é“ä¸­å†™æ•°æ®ï¼Œé‚£ä¹ˆåœ¨ç®¡é“è¢«å†™æ»¡çš„æ—¶å€™å†æ¬¡writeä¼šé˜»å¡ï¼Œ
ç›´åˆ°ç®¡é“ä¸­æœ‰ç©ºä½ç½®æ‰èƒ½å†æ¬¡å†™å…¥æ•°æ®å¹¶è¿”å›ã€‚

æ€»ç»“ï¼š
    è¯»ç®¡é“ï¼š
        ç®¡é“ä¸­æœ‰æ•°æ®ï¼Œreadè¿”å›å®é™…è¯»åˆ°çš„å­—èŠ‚æ•°ã€‚
        ç®¡é“ä¸­æ— æ•°æ®ï¼š
            å†™ç«¯è¢«å…¨éƒ¨å…³é—­ï¼Œreadè¿”å›<span class="token number">0</span>ï¼ˆç›¸å½“äºè¯»åˆ°æ–‡ä»¶çš„æœ«å°¾ï¼‰
            å†™ç«¯æ²¡æœ‰å®Œå…¨å…³é—­ï¼Œreadé˜»å¡ç­‰å¾…

    å†™ç®¡é“ï¼š
        ç®¡é“è¯»ç«¯å…¨éƒ¨è¢«å…³é—­ï¼Œè¿›ç¨‹å¼‚å¸¸ç»ˆæ­¢ï¼ˆè¿›ç¨‹æ”¶åˆ°SIGPIPEä¿¡å·ï¼‰
        ç®¡é“è¯»ç«¯æ²¡æœ‰å…¨éƒ¨å…³é—­ï¼š
            ç®¡é“å·²æ»¡ï¼Œwriteé˜»å¡
            ç®¡é“æ²¡æœ‰æ»¡ï¼Œwriteå°†æ•°æ®å†™å…¥ï¼Œå¹¶è¿”å›å®é™…å†™å…¥çš„å­—èŠ‚æ•°
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h4 id="_2ã€noblock-c"><a href="#_2ã€noblock-c" class="header-anchor">#</a> 2ã€noblock.c</h4> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h&gt;</span></span>
<span class="token comment">/*
    è®¾ç½®ç®¡é“éé˜»å¡
    int flags = fcntl(fd[0], F_GETFL);  // è·å–åŸæ¥çš„flag
    flags |= O_NONBLOCK;            // ä¿®æ”¹flagçš„å€¼
    fcntl(fd[0], F_SETFL, flags);   // è®¾ç½®æ–°çš„flag
*/</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// åœ¨forkä¹‹å‰åˆ›å»ºç®¡é“</span>
    <span class="token keyword">int</span> pipefd<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">pipe</span><span class="token punctuation">(</span>pipefd<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;pipe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// åˆ›å»ºå­è¿›ç¨‹</span>
    <span class="token class-name">pid_t</span> pid <span class="token operator">=</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>pid <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// çˆ¶è¿›ç¨‹</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;i am parent process, pid : %d\n&quot;</span><span class="token punctuation">,</span> <span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// å…³é—­å†™ç«¯</span>
        <span class="token function">close</span><span class="token punctuation">(</span>pipefd<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// ä»ç®¡é“çš„è¯»å–ç«¯è¯»å–æ•°æ®</span>
        <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token keyword">int</span> flags <span class="token operator">=</span> <span class="token function">fcntl</span><span class="token punctuation">(</span>pipefd<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> F_GETFL<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// è·å–åŸæ¥çš„flag</span>
        flags <span class="token operator">|=</span> O_NONBLOCK<span class="token punctuation">;</span>            <span class="token comment">// ä¿®æ”¹flagçš„å€¼</span>
        <span class="token function">fcntl</span><span class="token punctuation">(</span>pipefd<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> F_SETFL<span class="token punctuation">,</span> flags<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// è®¾ç½®æ–°çš„flag</span>

        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token function">read</span><span class="token punctuation">(</span>pipefd<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;len : %d\n&quot;</span><span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;parent recv : %s, pid : %d\n&quot;</span><span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">memset</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>pid <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// å­è¿›ç¨‹</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;i am child process, pid : %d\n&quot;</span><span class="token punctuation">,</span> <span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// å…³é—­è¯»ç«¯</span>
        <span class="token function">close</span><span class="token punctuation">(</span>pipefd<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// å‘ç®¡é“ä¸­å†™å…¥æ•°æ®</span>
            <span class="token keyword">char</span> <span class="token operator">*</span> str <span class="token operator">=</span> <span class="token string">&quot;hello,i am child&quot;</span><span class="token punctuation">;</span>
            <span class="token function">write</span><span class="token punctuation">(</span>pipefd<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> str<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>



</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br></div></div><h3 id="_15-æœ‰åç®¡é“ä»‹ç»åŠä½¿ç”¨"><a href="#_15-æœ‰åç®¡é“ä»‹ç»åŠä½¿ç”¨" class="header-anchor">#</a> 15.æœ‰åç®¡é“ä»‹ç»åŠä½¿ç”¨</h3> <h4 id="ã€ã€mkfifo-c"><a href="#ã€ã€mkfifo-c" class="header-anchor">#</a> ã€ã€mkfifo.c</h4> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">/*
    åˆ›å»ºfifoæ–‡ä»¶
    1.é€šè¿‡å‘½ä»¤ï¼š mkfifo åå­—
    2.é€šè¿‡å‡½æ•°ï¼šint mkfifo(const char *pathname, mode_t mode);

    #include &lt;sys/types.h&gt;
    #include &lt;sys/stat.h&gt;
    int mkfifo(const char *pathname, mode_t mode);
        å‚æ•°ï¼š
            - pathname: ç®¡é“åç§°çš„è·¯å¾„
            - mode: æ–‡ä»¶çš„æƒé™ å’Œ open çš„ mode æ˜¯ä¸€æ ·çš„
                    æ˜¯ä¸€ä¸ªå…«è¿›åˆ¶çš„æ•°
        è¿”å›å€¼ï¼šæˆåŠŸè¿”å›0ï¼Œå¤±è´¥è¿”å›-1ï¼Œå¹¶è®¾ç½®é”™è¯¯å·

*/</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/stat.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>


    <span class="token comment">// åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span>
    <span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">access</span><span class="token punctuation">(</span><span class="token string">&quot;fifo1&quot;</span><span class="token punctuation">,</span> F_OK<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;ç®¡é“ä¸å­˜åœ¨ï¼Œåˆ›å»ºç®¡é“\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        ret <span class="token operator">=</span> <span class="token function">mkfifo</span><span class="token punctuation">(</span><span class="token string">&quot;fifo1&quot;</span><span class="token punctuation">,</span> <span class="token number">0664</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;mkfifo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>       

    <span class="token punctuation">}</span>

    

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><h4 id="ã€2ã€read-c"><a href="#ã€2ã€read-c" class="header-anchor">#</a> ã€2ã€read.c</h4> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/stat.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h&gt;</span></span>

<span class="token comment">// ä»ç®¡é“ä¸­è¯»å–æ•°æ®</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// 1.æ‰“å¼€ç®¡é“æ–‡ä»¶</span>
    <span class="token keyword">int</span> fd <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span> O_RDONLY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>fd <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;open&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// è¯»æ•°æ®</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token function">read</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>len <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;å†™ç«¯æ–­å¼€è¿æ¥äº†...\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;recv buf : %s\n&quot;</span><span class="token punctuation">,</span> buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h4 id="ã€3ã€write-c"><a href="#ã€3ã€write-c" class="header-anchor">#</a> ã€3ã€write.c</h4> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/stat.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>

<span class="token comment">// å‘ç®¡é“ä¸­å†™æ•°æ®</span>
<span class="token comment">/*
    æœ‰åç®¡é“çš„æ³¨æ„äº‹é¡¹ï¼š
        1.ä¸€ä¸ªä¸ºåªè¯»è€Œæ‰“å¼€ä¸€ä¸ªç®¡é“çš„è¿›ç¨‹ä¼šé˜»å¡ï¼Œç›´åˆ°å¦å¤–ä¸€ä¸ªè¿›ç¨‹ä¸ºåªå†™æ‰“å¼€ç®¡é“
        2.ä¸€ä¸ªä¸ºåªå†™è€Œæ‰“å¼€ä¸€ä¸ªç®¡é“çš„è¿›ç¨‹ä¼šé˜»å¡ï¼Œç›´åˆ°å¦å¤–ä¸€ä¸ªè¿›ç¨‹ä¸ºåªè¯»æ‰“å¼€ç®¡é“

    è¯»ç®¡é“ï¼š
        ç®¡é“ä¸­æœ‰æ•°æ®ï¼Œreadè¿”å›å®é™…è¯»åˆ°çš„å­—èŠ‚æ•°
        ç®¡é“ä¸­æ— æ•°æ®ï¼š
            ç®¡é“å†™ç«¯è¢«å…¨éƒ¨å…³é—­ï¼Œreadè¿”å›0ï¼Œï¼ˆç›¸å½“äºè¯»åˆ°æ–‡ä»¶æœ«å°¾ï¼‰
            å†™ç«¯æ²¡æœ‰å…¨éƒ¨è¢«å…³é—­ï¼Œreadé˜»å¡ç­‰å¾…
    
    å†™ç®¡é“ï¼š
        ç®¡é“è¯»ç«¯è¢«å…¨éƒ¨å…³é—­ï¼Œè¿›è¡Œå¼‚å¸¸ç»ˆæ­¢ï¼ˆæ”¶åˆ°ä¸€ä¸ªSIGPIPEä¿¡å·ï¼‰
        ç®¡é“è¯»ç«¯æ²¡æœ‰å…¨éƒ¨å…³é—­ï¼š
            ç®¡é“å·²ç»æ»¡äº†ï¼Œwriteä¼šé˜»å¡
            ç®¡é“æ²¡æœ‰æ»¡ï¼Œwriteå°†æ•°æ®å†™å…¥ï¼Œå¹¶è¿”å›å®é™…å†™å…¥çš„å­—èŠ‚æ•°ã€‚
*/</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// 1.åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span>
    <span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">access</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span> F_OK<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;ç®¡é“ä¸å­˜åœ¨ï¼Œåˆ›å»ºç®¡é“\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 2.åˆ›å»ºç®¡é“æ–‡ä»¶</span>
        ret <span class="token operator">=</span> <span class="token function">mkfifo</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span> <span class="token number">0664</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;mkfifo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>       

    <span class="token punctuation">}</span>

    <span class="token comment">// 3.ä»¥åªå†™çš„æ–¹å¼æ‰“å¼€ç®¡é“</span>
    <span class="token keyword">int</span> fd <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span> O_WRONLY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>fd <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;open&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// å†™æ•°æ®</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token function">sprintf</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token string">&quot;hello, %d\n&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;write data : %s\n&quot;</span><span class="token punctuation">,</span> buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">write</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br></div></div><h3 id="_16-æœ‰åç®¡é“å®ç°ç®€å•ç‰ˆèŠå¤©åŠŸèƒ½"><a href="#_16-æœ‰åç®¡é“å®ç°ç®€å•ç‰ˆèŠå¤©åŠŸèƒ½" class="header-anchor">#</a> 16.æœ‰åç®¡é“å®ç°ç®€å•ç‰ˆèŠå¤©åŠŸèƒ½</h3> <h4 id="ã€1ã€chata-c"><a href="#ã€1ã€chata-c" class="header-anchor">#</a> ã€1ã€chatA.c</h4> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/stat.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// 1.åˆ¤æ–­æœ‰åç®¡é“æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span>
    <span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">access</span><span class="token punctuation">(</span><span class="token string">&quot;fifo1&quot;</span><span class="token punctuation">,</span> F_OK<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// æ–‡ä»¶ä¸å­˜åœ¨</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;ç®¡é“ä¸å­˜åœ¨ï¼Œåˆ›å»ºå¯¹åº”çš„æœ‰åç®¡é“\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ret <span class="token operator">=</span> <span class="token function">mkfifo</span><span class="token punctuation">(</span><span class="token string">&quot;fifo1&quot;</span><span class="token punctuation">,</span> <span class="token number">0664</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;mkfifo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    ret <span class="token operator">=</span> <span class="token function">access</span><span class="token punctuation">(</span><span class="token string">&quot;fifo2&quot;</span><span class="token punctuation">,</span> F_OK<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// æ–‡ä»¶ä¸å­˜åœ¨</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;ç®¡é“ä¸å­˜åœ¨ï¼Œåˆ›å»ºå¯¹åº”çš„æœ‰åç®¡é“\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ret <span class="token operator">=</span> <span class="token function">mkfifo</span><span class="token punctuation">(</span><span class="token string">&quot;fifo2&quot;</span><span class="token punctuation">,</span> <span class="token number">0664</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;mkfifo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 2.ä»¥åªå†™çš„æ–¹å¼æ‰“å¼€ç®¡é“fifo1</span>
    <span class="token keyword">int</span> fdw <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;fifo1&quot;</span><span class="token punctuation">,</span> O_WRONLY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>fdw <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;open&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;æ‰“å¼€ç®¡é“fifo1æˆåŠŸï¼Œç­‰å¾…å†™å…¥...\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 3.ä»¥åªè¯»çš„æ–¹å¼æ‰“å¼€ç®¡é“fifo2</span>
    <span class="token keyword">int</span> fdr <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;fifo2&quot;</span><span class="token punctuation">,</span> O_RDONLY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>fdr <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;open&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;æ‰“å¼€ç®¡é“fifo2æˆåŠŸï¼Œç­‰å¾…è¯»å–...\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">// 4.å¾ªç¯çš„å†™è¯»æ•°æ®</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">memset</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è·å–æ ‡å‡†è¾“å…¥çš„æ•°æ®</span>
        <span class="token function">fgets</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token constant">stdin</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// å†™æ•°æ®</span>
        ret <span class="token operator">=</span> <span class="token function">write</span><span class="token punctuation">(</span>fdw<span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;write&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 5.è¯»ç®¡é“æ•°æ®</span>
        <span class="token function">memset</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ret <span class="token operator">=</span> <span class="token function">read</span><span class="token punctuation">(</span>fdr<span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;read&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;buf: %s\n&quot;</span><span class="token punctuation">,</span> buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 6.å…³é—­æ–‡ä»¶æè¿°ç¬¦</span>
    <span class="token function">close</span><span class="token punctuation">(</span>fdr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">close</span><span class="token punctuation">(</span>fdw<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br></div></div><h4 id="ã€2ã€chatb-c"><a href="#ã€2ã€chatb-c" class="header-anchor">#</a> ã€2ã€chatB.c</h4> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/stat.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// 1.åˆ¤æ–­æœ‰åç®¡é“æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span>
    <span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">access</span><span class="token punctuation">(</span><span class="token string">&quot;fifo1&quot;</span><span class="token punctuation">,</span> F_OK<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// æ–‡ä»¶ä¸å­˜åœ¨</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;ç®¡é“ä¸å­˜åœ¨ï¼Œåˆ›å»ºå¯¹åº”çš„æœ‰åç®¡é“\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ret <span class="token operator">=</span> <span class="token function">mkfifo</span><span class="token punctuation">(</span><span class="token string">&quot;fifo1&quot;</span><span class="token punctuation">,</span> <span class="token number">0664</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;mkfifo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    ret <span class="token operator">=</span> <span class="token function">access</span><span class="token punctuation">(</span><span class="token string">&quot;fifo2&quot;</span><span class="token punctuation">,</span> F_OK<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// æ–‡ä»¶ä¸å­˜åœ¨</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;ç®¡é“ä¸å­˜åœ¨ï¼Œåˆ›å»ºå¯¹åº”çš„æœ‰åç®¡é“\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ret <span class="token operator">=</span> <span class="token function">mkfifo</span><span class="token punctuation">(</span><span class="token string">&quot;fifo2&quot;</span><span class="token punctuation">,</span> <span class="token number">0664</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;mkfifo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 2.ä»¥åªè¯»çš„æ–¹å¼æ‰“å¼€ç®¡é“fifo1</span>
    <span class="token keyword">int</span> fdr <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;fifo1&quot;</span><span class="token punctuation">,</span> O_RDONLY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>fdr <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;open&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;æ‰“å¼€ç®¡é“fifo1æˆåŠŸï¼Œç­‰å¾…è¯»å–...\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 3.ä»¥åªå†™çš„æ–¹å¼æ‰“å¼€ç®¡é“fifo2</span>
    <span class="token keyword">int</span> fdw <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;fifo2&quot;</span><span class="token punctuation">,</span> O_WRONLY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>fdw <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;open&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;æ‰“å¼€ç®¡é“fifo2æˆåŠŸï¼Œç­‰å¾…å†™å…¥...\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">// 4.å¾ªç¯çš„è¯»å†™æ•°æ®</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 5.è¯»ç®¡é“æ•°æ®</span>
        <span class="token function">memset</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ret <span class="token operator">=</span> <span class="token function">read</span><span class="token punctuation">(</span>fdr<span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;read&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;buf: %s\n&quot;</span><span class="token punctuation">,</span> buf<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">memset</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è·å–æ ‡å‡†è¾“å…¥çš„æ•°æ®</span>
        <span class="token function">fgets</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token constant">stdin</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// å†™æ•°æ®</span>
        ret <span class="token operator">=</span> <span class="token function">write</span><span class="token punctuation">(</span>fdw<span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;write&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 6.å…³é—­æ–‡ä»¶æè¿°ç¬¦</span>
    <span class="token function">close</span><span class="token punctuation">(</span>fdr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">close</span><span class="token punctuation">(</span>fdw<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br></div></div><h3 id="_17-å†…å­˜æ˜ å°„-1"><a href="#_17-å†…å­˜æ˜ å°„-1" class="header-anchor">#</a> 17.å†…å­˜æ˜ å°„(1)</h3> <h4 id="_1-mmap-parent-child-ipc-c"><a href="#_1-mmap-parent-child-ipc-c" class="header-anchor">#</a> 1.mmap-parent-child-ipc.c</h4> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">/*
    #include &lt;sys/mman.h&gt;
    void *mmap(void *addr, size_t length, int prot, int flags,int fd, off_t offset);
        - åŠŸèƒ½ï¼šå°†ä¸€ä¸ªæ–‡ä»¶æˆ–è€…è®¾å¤‡çš„æ•°æ®æ˜ å°„åˆ°å†…å­˜ä¸­
        - å‚æ•°ï¼š
            - void *addr: NULL, ç”±å†…æ ¸æŒ‡å®š
            - length : è¦æ˜ å°„çš„æ•°æ®çš„é•¿åº¦ï¼Œè¿™ä¸ªå€¼ä¸èƒ½ä¸º0ã€‚å»ºè®®ä½¿ç”¨æ–‡ä»¶çš„é•¿åº¦ã€‚
                    è·å–æ–‡ä»¶çš„é•¿åº¦ï¼šstat lseek
            - prot : å¯¹ç”³è¯·çš„å†…å­˜æ˜ å°„åŒºçš„æ“ä½œæƒé™
                -PROT_EXEC ï¼šå¯æ‰§è¡Œçš„æƒé™
                -PROT_READ ï¼šè¯»æƒé™
                -PROT_WRITE ï¼šå†™æƒé™
                -PROT_NONE ï¼šæ²¡æœ‰æƒé™
                è¦æ“ä½œæ˜ å°„å†…å­˜ï¼Œå¿…é¡»è¦æœ‰è¯»çš„æƒé™ã€‚
                PROT_READã€PROT_READ|PROT_WRITE
            - flags :
                - MAP_SHARED : æ˜ å°„åŒºçš„æ•°æ®ä¼šè‡ªåŠ¨å’Œç£ç›˜æ–‡ä»¶è¿›è¡ŒåŒæ­¥ï¼Œè¿›ç¨‹é—´é€šä¿¡ï¼Œå¿…é¡»è¦è®¾ç½®è¿™ä¸ªé€‰é¡¹
                - MAP_PRIVATE ï¼šä¸åŒæ­¥ï¼Œå†…å­˜æ˜ å°„åŒºçš„æ•°æ®æ”¹å˜äº†ï¼Œå¯¹åŸæ¥çš„æ–‡ä»¶ä¸ä¼šä¿®æ”¹ï¼Œä¼šé‡æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶ã€‚ï¼ˆcopy on writeï¼‰
            - fd: éœ€è¦æ˜ å°„çš„é‚£ä¸ªæ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦
                - é€šè¿‡openå¾—åˆ°ï¼Œopençš„æ˜¯ä¸€ä¸ªç£ç›˜æ–‡ä»¶
                - æ³¨æ„ï¼šæ–‡ä»¶çš„å¤§å°ä¸èƒ½ä¸º0ï¼ŒopenæŒ‡å®šçš„æƒé™ä¸èƒ½å’Œprotå‚æ•°æœ‰å†²çªã€‚
                    prot: PROT_READ                open:åªè¯»/è¯»å†™ 
                    prot: PROT_READ | PROT_WRITE   open:è¯»å†™
            - offsetï¼šåç§»é‡ï¼Œä¸€èˆ¬ä¸ç”¨ã€‚å¿…é¡»æŒ‡å®šçš„æ˜¯4kçš„æ•´æ•°å€ï¼Œ0è¡¨ç¤ºä¸ä¾¿å®œã€‚
        - è¿”å›å€¼ï¼šè¿”å›åˆ›å»ºçš„å†…å­˜çš„é¦–åœ°å€
            å¤±è´¥è¿”å›MAP_FAILEDï¼Œ(void *) -1

    int munmap(void *addr, size_t length);
        - åŠŸèƒ½ï¼šé‡Šæ”¾å†…å­˜æ˜ å°„
        - å‚æ•°ï¼š
            - addr : è¦é‡Šæ”¾çš„å†…å­˜çš„é¦–åœ°å€
            - length : è¦é‡Šæ”¾çš„å†…å­˜çš„å¤§å°ï¼Œè¦å’Œmmapå‡½æ•°ä¸­çš„lengthå‚æ•°çš„å€¼ä¸€æ ·ã€‚
*/</span>

<span class="token comment">/*
    ä½¿ç”¨å†…å­˜æ˜ å°„å®ç°è¿›ç¨‹é—´é€šä¿¡ï¼š
    1.æœ‰å…³ç³»çš„è¿›ç¨‹ï¼ˆçˆ¶å­è¿›ç¨‹ï¼‰
        - è¿˜æ²¡æœ‰å­è¿›ç¨‹çš„æ—¶å€™
            - é€šè¿‡å”¯ä¸€çš„çˆ¶è¿›ç¨‹ï¼Œå…ˆåˆ›å»ºå†…å­˜æ˜ å°„åŒº
        - æœ‰äº†å†…å­˜æ˜ å°„åŒºä»¥åï¼Œåˆ›å»ºå­è¿›ç¨‹
        - çˆ¶å­è¿›ç¨‹å…±äº«åˆ›å»ºçš„å†…å­˜æ˜ å°„åŒº
    
    2.æ²¡æœ‰å…³ç³»çš„è¿›ç¨‹é—´é€šä¿¡
        - å‡†å¤‡ä¸€ä¸ªå¤§å°ä¸æ˜¯0çš„ç£ç›˜æ–‡ä»¶
        - è¿›ç¨‹1 é€šè¿‡ç£ç›˜æ–‡ä»¶åˆ›å»ºå†…å­˜æ˜ å°„åŒº
            - å¾—åˆ°ä¸€ä¸ªæ“ä½œè¿™å—å†…å­˜çš„æŒ‡é’ˆ
        - è¿›ç¨‹2 é€šè¿‡ç£ç›˜æ–‡ä»¶åˆ›å»ºå†…å­˜æ˜ å°„åŒº
            - å¾—åˆ°ä¸€ä¸ªæ“ä½œè¿™å—å†…å­˜çš„æŒ‡é’ˆ
        - ä½¿ç”¨å†…å­˜æ˜ å°„åŒºé€šä¿¡

    æ³¨æ„ï¼šå†…å­˜æ˜ å°„åŒºé€šä¿¡ï¼Œæ˜¯éé˜»å¡ã€‚
*/</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/mman.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;wait.h&gt;</span></span>

<span class="token comment">// ä½œä¸š:ä½¿ç”¨å†…å­˜æ˜ å°„å®ç°æ²¡æœ‰å…³ç³»çš„è¿›ç¨‹é—´çš„é€šä¿¡ã€‚</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// 1.æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶</span>
    <span class="token keyword">int</span> fd <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;test.txt&quot;</span><span class="token punctuation">,</span> O_RDWR<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> size <span class="token operator">=</span> <span class="token function">lseek</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">SEEK_END</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// è·å–æ–‡ä»¶çš„å¤§å°</span>

    <span class="token comment">// 2.åˆ›å»ºå†…å­˜æ˜ å°„åŒº</span>
    <span class="token keyword">void</span> <span class="token operator">*</span>ptr <span class="token operator">=</span> <span class="token function">mmap</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> size<span class="token punctuation">,</span> PROT_READ <span class="token operator">|</span> PROT_WRITE<span class="token punctuation">,</span> MAP_SHARED<span class="token punctuation">,</span> fd<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>ptr <span class="token operator">==</span> MAP_FAILED<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;mmap&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 3.åˆ›å»ºå­è¿›ç¨‹</span>
    <span class="token class-name">pid_t</span> pid <span class="token operator">=</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>pid <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">wait</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// çˆ¶è¿›ç¨‹</span>
        <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token function">strcpy</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>ptr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;read data : %s\n&quot;</span><span class="token punctuation">,</span> buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
       
    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>pid <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// å­è¿›ç¨‹</span>
        <span class="token function">strcpy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>ptr<span class="token punctuation">,</span> <span class="token string">&quot;nihao a, son!!!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// å…³é—­å†…å­˜æ˜ å°„åŒº</span>
    <span class="token function">munmap</span><span class="token punctuation">(</span>ptr<span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br></div></div><h4 id="test-txt"><a href="#test-txt" class="header-anchor">#</a> test.txt</h4> <div class="language-txt line-numbers-mode"><pre class="language-text"><code>nihao a, son!!! world,helloworld,helloworld,helloworld,helloworld,helloworld,helloworld,helloworld,helloworld,helloworld,helloworld,helloworld,helloworld,helloworld.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_18-å†…å­˜æ˜ å°„-2"><a href="#_18-å†…å­˜æ˜ å°„-2" class="header-anchor">#</a> 18-å†…å­˜æ˜ å°„(2)</h3> <h4 id="_1-copy-c"><a href="#_1-copy-c" class="header-anchor">#</a> 1.copy.c</h4> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">// ä½¿ç”¨å†…å­˜æ˜ å°„å®ç°æ–‡ä»¶æ‹·è´çš„åŠŸèƒ½</span>
<span class="token comment">/*
    æ€è·¯ï¼š
        1.å¯¹åŸå§‹çš„æ–‡ä»¶è¿›è¡Œå†…å­˜æ˜ å°„
        2.åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ï¼ˆæ‹“å±•è¯¥æ–‡ä»¶ï¼‰
        3.æŠŠæ–°æ–‡ä»¶çš„æ•°æ®æ˜ å°„åˆ°å†…å­˜ä¸­
        4.é€šè¿‡å†…å­˜æ‹·è´å°†ç¬¬ä¸€ä¸ªæ–‡ä»¶çš„å†…å­˜æ•°æ®æ‹·è´åˆ°æ–°çš„æ–‡ä»¶å†…å­˜ä¸­
        5.é‡Šæ”¾èµ„æº
*/</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/mman.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/stat.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// 1.å¯¹åŸå§‹çš„æ–‡ä»¶è¿›è¡Œå†…å­˜æ˜ å°„</span>
    <span class="token keyword">int</span> fd <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;english.txt&quot;</span><span class="token punctuation">,</span> O_RDWR<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>fd <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;open&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// è·å–åŸå§‹æ–‡ä»¶çš„å¤§å°</span>
    <span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token function">lseek</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">SEEK_END</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 2.åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ï¼ˆæ‹“å±•è¯¥æ–‡ä»¶ï¼‰</span>
    <span class="token keyword">int</span> fd1 <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;cpy.txt&quot;</span><span class="token punctuation">,</span> O_RDWR <span class="token operator">|</span> O_CREAT<span class="token punctuation">,</span> <span class="token number">0664</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>fd1 <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;open&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// å¯¹æ–°åˆ›å»ºçš„æ–‡ä»¶è¿›è¡Œæ‹“å±•</span>
    <span class="token function">truncate</span><span class="token punctuation">(</span><span class="token string">&quot;cpy.txt&quot;</span><span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">write</span><span class="token punctuation">(</span>fd1<span class="token punctuation">,</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 3.åˆ†åˆ«åšå†…å­˜æ˜ å°„</span>
    <span class="token keyword">void</span> <span class="token operator">*</span> ptr <span class="token operator">=</span> <span class="token function">mmap</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> len<span class="token punctuation">,</span> PROT_READ <span class="token operator">|</span> PROT_WRITE<span class="token punctuation">,</span> MAP_SHARED<span class="token punctuation">,</span> fd<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token operator">*</span> ptr1 <span class="token operator">=</span> <span class="token function">mmap</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> len<span class="token punctuation">,</span> PROT_READ <span class="token operator">|</span> PROT_WRITE<span class="token punctuation">,</span> MAP_SHARED<span class="token punctuation">,</span> fd1<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>ptr <span class="token operator">==</span> MAP_FAILED<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;mmap&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>ptr1 <span class="token operator">==</span> MAP_FAILED<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;mmap&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// å†…å­˜æ‹·è´</span>
    <span class="token function">memcpy</span><span class="token punctuation">(</span>ptr1<span class="token punctuation">,</span> ptr<span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// é‡Šæ”¾èµ„æº</span>
    <span class="token function">munmap</span><span class="token punctuation">(</span>ptr1<span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">munmap</span><span class="token punctuation">(</span>ptr<span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">close</span><span class="token punctuation">(</span>fd1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br></div></div><h4 id="cpy-txtå’Œenglish-txt"><a href="#cpy-txtå’Œenglish-txt" class="header-anchor">#</a> cpy.txtå’Œenglish.txt</h4> <ul><li>è§æ–‡ä»¶</li></ul> <h4 id="mmap-anon-c"><a href="#mmap-anon-c" class="header-anchor">#</a> mmap-anon.c</h4> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">/*
    åŒ¿åæ˜ å°„ï¼šä¸éœ€è¦æ–‡ä»¶å®ä½“è¿›ç¨‹ä¸€ä¸ªå†…å­˜æ˜ å°„
*/</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/mman.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/stat.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/wait.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// 1.åˆ›å»ºåŒ¿åå†…å­˜æ˜ å°„åŒº</span>
    <span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token number">4096</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token operator">*</span> ptr <span class="token operator">=</span> <span class="token function">mmap</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> len<span class="token punctuation">,</span> PROT_READ <span class="token operator">|</span> PROT_WRITE<span class="token punctuation">,</span> MAP_SHARED <span class="token operator">|</span> MAP_ANONYMOUS<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>ptr <span class="token operator">==</span> MAP_FAILED<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;mmap&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// çˆ¶å­è¿›ç¨‹é—´é€šä¿¡</span>
    <span class="token class-name">pid_t</span> pid <span class="token operator">=</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>pid <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// çˆ¶è¿›ç¨‹</span>
        <span class="token function">strcpy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span> ptr<span class="token punctuation">,</span> <span class="token string">&quot;hello, world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">wait</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>pid <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// å­è¿›ç¨‹</span>
        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s\n&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>ptr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// é‡Šæ”¾å†…å­˜æ˜ å°„åŒº</span>
    <span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">munmap</span><span class="token punctuation">(</span>ptr<span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;munmap&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><h4 id="å†…å­˜æ˜ å°„çš„æ³¨æ„äº‹é¡¹-txt"><a href="#å†…å­˜æ˜ å°„çš„æ³¨æ„äº‹é¡¹-txt" class="header-anchor">#</a> å†…å­˜æ˜ å°„çš„æ³¨æ„äº‹é¡¹.txt</h4> <div class="language-txt line-numbers-mode"><pre class="language-text"><code>1.å¦‚æœå¯¹mmapçš„è¿”å›å€¼(ptr)åš++æ“ä½œ(ptr++), munmapæ˜¯å¦èƒ½å¤ŸæˆåŠŸ?
void * ptr = mmap(...);
ptr++;  å¯ä»¥å¯¹å…¶è¿›è¡Œ++æ“ä½œ
munmap(ptr, len);   // é”™è¯¯,è¦ä¿å­˜åœ°å€

2.å¦‚æœopenæ—¶O_RDONLY, mmapæ—¶protå‚æ•°æŒ‡å®šPROT_READ | PROT_WRITEä¼šæ€æ ·?
é”™è¯¯ï¼Œè¿”å›MAP_FAILED
open()å‡½æ•°ä¸­çš„æƒé™å»ºè®®å’Œprotå‚æ•°çš„æƒé™ä¿æŒä¸€è‡´ã€‚

3.å¦‚æœæ–‡ä»¶åç§»é‡ä¸º1000ä¼šæ€æ ·?
åç§»é‡å¿…é¡»æ˜¯4Kçš„æ•´æ•°å€ï¼Œè¿”å›MAP_FAILED

4.mmapä»€ä¹ˆæƒ…å†µä¸‹ä¼šè°ƒç”¨å¤±è´¥?
    - ç¬¬äºŒä¸ªå‚æ•°ï¼šlength = 0
    - ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šprot
        - åªæŒ‡å®šäº†å†™æƒé™
        - prot PROT_READ | PROT_WRITE
          ç¬¬5ä¸ªå‚æ•°fd é€šè¿‡openå‡½æ•°æ—¶æŒ‡å®šçš„ O_RDONLY / O_WRONLY

5.å¯ä»¥opençš„æ—¶å€™O_CREATä¸€ä¸ªæ–°æ–‡ä»¶æ¥åˆ›å»ºæ˜ å°„åŒºå—?
    - å¯ä»¥çš„ï¼Œä½†æ˜¯åˆ›å»ºçš„æ–‡ä»¶çš„å¤§å°å¦‚æœä¸º0çš„è¯ï¼Œè‚¯å®šä¸è¡Œ
    - å¯ä»¥å¯¹æ–°çš„æ–‡ä»¶è¿›è¡Œæ‰©å±•
        - lseek()
        - truncate()

6.mmapåå…³é—­æ–‡ä»¶æè¿°ç¬¦ï¼Œå¯¹mmapæ˜ å°„æœ‰æ²¡æœ‰å½±å“ï¼Ÿ
    int fd = open(&quot;XXX&quot;);
    mmap(,,,,fd,0);
    close(fd); 
    æ˜ å°„åŒºè¿˜å­˜åœ¨ï¼Œåˆ›å»ºæ˜ å°„åŒºçš„fdè¢«å…³é—­ï¼Œæ²¡æœ‰ä»»ä½•å½±å“ã€‚

7.å¯¹ptrè¶Šç•Œæ“ä½œä¼šæ€æ ·ï¼Ÿ
void * ptr = mmap(NULL, 100,,,,,);
4K
è¶Šç•Œæ“ä½œæ“ä½œçš„æ˜¯éæ³•çš„å†…å­˜ -&gt; æ®µé”™è¯¯


</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><h3 id="_19-ä¿¡å·æ¦‚è¿°"><a href="#_19-ä¿¡å·æ¦‚è¿°" class="header-anchor">#</a> 19.ä¿¡å·æ¦‚è¿°</h3> <h3 id="_20-killã€raiseã€abortå‡½æ•°"><a href="#_20-killã€raiseã€abortå‡½æ•°" class="header-anchor">#</a> 20.<code>kill</code>ã€<code>raise</code>ã€<code>abort</code>å‡½æ•°</h3> <h4 id="ã€1ã€core-c"><a href="#ã€1ã€core-c" class="header-anchor">#</a> ã€1ã€core.c</h4> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">char</span> <span class="token operator">*</span> buf<span class="token punctuation">;</span>

    <span class="token function">strcpy</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="ã€2ã€kill-c"><a href="#ã€2ã€kill-c" class="header-anchor">#</a> ã€2ã€kill.c</h4> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">/*  
    #include &lt;sys/types.h&gt;
    #include &lt;signal.h&gt;

    int kill(pid_t pid, int sig);
        - åŠŸèƒ½ï¼šç»™ä»»ä½•çš„è¿›ç¨‹æˆ–è€…è¿›ç¨‹ç»„pid, å‘é€ä»»ä½•çš„ä¿¡å· sig
        - å‚æ•°ï¼š
            - pid ï¼š
                &gt; 0 : å°†ä¿¡å·å‘é€ç»™æŒ‡å®šçš„è¿›ç¨‹
                = 0 : å°†ä¿¡å·å‘é€ç»™å½“å‰çš„è¿›ç¨‹ç»„
                = -1 : å°†ä¿¡å·å‘é€ç»™æ¯ä¸€ä¸ªæœ‰æƒé™æ¥æ”¶è¿™ä¸ªä¿¡å·çš„è¿›ç¨‹
                &lt; -1 : è¿™ä¸ªpid=æŸä¸ªè¿›ç¨‹ç»„çš„IDå–å ï¼ˆ-12345ï¼‰
            - sig : éœ€è¦å‘é€çš„ä¿¡å·çš„ç¼–å·æˆ–è€…æ˜¯å®å€¼ï¼Œ0è¡¨ç¤ºä¸å‘é€ä»»ä½•ä¿¡å·

        kill(getppid(), 9);
        kill(getpid(), 9);
        
    int raise(int sig);
        - åŠŸèƒ½ï¼šç»™å½“å‰è¿›ç¨‹å‘é€ä¿¡å·
        - å‚æ•°ï¼š
            - sig : è¦å‘é€çš„ä¿¡å·
        - è¿”å›å€¼ï¼š
            - æˆåŠŸ 0
            - å¤±è´¥ é0
        kill(getpid(), sig);   

    void abort(void);
        - åŠŸèƒ½ï¼š å‘é€SIGABRTä¿¡å·ç»™å½“å‰çš„è¿›ç¨‹ï¼Œæ€æ­»å½“å‰è¿›ç¨‹
        kill(getpid(), SIGABRT);
*/</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;signal.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token class-name">pid_t</span> pid <span class="token operator">=</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>pid <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// å­è¿›ç¨‹</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;child process\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>pid <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// çˆ¶è¿›ç¨‹</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;parent process\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;kill child process now\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">kill</span><span class="token punctuation">(</span>pid<span class="token punctuation">,</span> SIGINT<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br></div></div><h3 id="_21-alarmå‡½æ•°"><a href="#_21-alarmå‡½æ•°" class="header-anchor">#</a> 21.alarmå‡½æ•°</h3> <h4 id="ã€1ã€alarm-c"><a href="#ã€1ã€alarm-c" class="header-anchor">#</a> ã€1ã€alarm.c</h4> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">/*
    #include &lt;unistd.h&gt;
    unsigned int alarm(unsigned int seconds);
        - åŠŸèƒ½ï¼šè®¾ç½®å®šæ—¶å™¨ï¼ˆé—¹é’Ÿï¼‰ã€‚å‡½æ•°è°ƒç”¨ï¼Œå¼€å§‹å€’è®¡æ—¶ï¼Œå½“å€’è®¡æ—¶ä¸º0çš„æ—¶å€™ï¼Œ
                å‡½æ•°ä¼šç»™å½“å‰çš„è¿›ç¨‹å‘é€ä¸€ä¸ªä¿¡å·ï¼šSIGALARM
        - å‚æ•°ï¼š
            seconds: å€’è®¡æ—¶çš„æ—¶é•¿ï¼Œå•ä½ï¼šç§’ã€‚å¦‚æœå‚æ•°ä¸º0ï¼Œå®šæ—¶å™¨æ— æ•ˆï¼ˆä¸è¿›è¡Œå€’è®¡æ—¶ï¼Œä¸å‘ä¿¡å·ï¼‰ã€‚
                    å–æ¶ˆä¸€ä¸ªå®šæ—¶å™¨ï¼Œé€šè¿‡alarm(0)ã€‚
        - è¿”å›å€¼ï¼š
            - ä¹‹å‰æ²¡æœ‰å®šæ—¶å™¨ï¼Œè¿”å›0
            - ä¹‹å‰æœ‰å®šæ—¶å™¨ï¼Œè¿”å›ä¹‹å‰çš„å®šæ—¶å™¨å‰©ä½™çš„æ—¶é—´

    - SIGALARM ï¼šé»˜è®¤ç»ˆæ­¢å½“å‰çš„è¿›ç¨‹ï¼Œæ¯ä¸€ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸”åªæœ‰å”¯ä¸€çš„ä¸€ä¸ªå®šæ—¶å™¨ã€‚
        alarm(10);  -&gt; è¿”å›0
        è¿‡äº†1ç§’
        alarm(5);   -&gt; è¿”å›9

    alarm(100) -&gt; è¯¥å‡½æ•°æ˜¯ä¸é˜»å¡çš„
*/</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">int</span> seconds <span class="token operator">=</span> <span class="token function">alarm</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;seconds = %d\n&quot;</span><span class="token punctuation">,</span> seconds<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 0</span>

    <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    seconds <span class="token operator">=</span> <span class="token function">alarm</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// ä¸é˜»å¡</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;seconds = %d\n&quot;</span><span class="token punctuation">,</span> seconds<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 3</span>

    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><h4 id="ã€2ã€alarm1-c"><a href="#ã€2ã€alarm1-c" class="header-anchor">#</a> ã€2ã€alarm1.c</h4> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">// 1ç§’é’Ÿç”µè„‘èƒ½æ•°å¤šå°‘ä¸ªæ•°ï¼Ÿ</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>

<span class="token comment">/*
    å®é™…çš„æ—¶é—´ = å†…æ ¸æ—¶é—´ + ç”¨æˆ·æ—¶é—´ + æ¶ˆè€—çš„æ—¶é—´
    è¿›è¡Œæ–‡ä»¶IOæ“ä½œçš„æ—¶å€™æ¯”è¾ƒæµªè´¹æ—¶é—´

    å®šæ—¶å™¨ï¼Œä¸è¿›ç¨‹çš„çŠ¶æ€æ— å…³ï¼ˆè‡ªç„¶å®šæ—¶æ³•ï¼‰ã€‚æ— è®ºè¿›ç¨‹å¤„äºä»€ä¹ˆçŠ¶æ€ï¼Œalarméƒ½ä¼šè®¡æ—¶ã€‚
*/</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    

    <span class="token function">alarm</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%i\n&quot;</span><span class="token punctuation">,</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="_22-setitimerå‡½æ•°"><a href="#_22-setitimerå‡½æ•°" class="header-anchor">#</a> 22.setitimerå‡½æ•°</h3> <h4 id="ã€1ã€setitimer-c"><a href="#ã€1ã€setitimer-c" class="header-anchor">#</a> ã€1ã€setitimer.c</h4> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">/*
    #include &lt;sys/time.h&gt;
    int setitimer(int which, const struct itimerval *new_value,
                        struct itimerval *old_value);
    
        - åŠŸèƒ½ï¼šè®¾ç½®å®šæ—¶å™¨ï¼ˆé—¹é’Ÿï¼‰ã€‚å¯ä»¥æ›¿ä»£alarmå‡½æ•°ã€‚ç²¾åº¦å¾®å¦™usï¼Œå¯ä»¥å®ç°å‘¨æœŸæ€§å®šæ—¶
        - å‚æ•°ï¼š
            - which : å®šæ—¶å™¨ä»¥ä»€ä¹ˆæ—¶é—´è®¡æ—¶
              ITIMER_REAL: çœŸå®æ—¶é—´ï¼Œæ—¶é—´åˆ°è¾¾ï¼Œå‘é€ SIGALRM   å¸¸ç”¨
              ITIMER_VIRTUAL: ç”¨æˆ·æ—¶é—´ï¼Œæ—¶é—´åˆ°è¾¾ï¼Œå‘é€ SIGVTALRM
              ITIMER_PROF: ä»¥è¯¥è¿›ç¨‹åœ¨ç”¨æˆ·æ€å’Œå†…æ ¸æ€ä¸‹æ‰€æ¶ˆè€—çš„æ—¶é—´æ¥è®¡ç®—ï¼Œæ—¶é—´åˆ°è¾¾ï¼Œå‘é€ SIGPROF

            - new_value: è®¾ç½®å®šæ—¶å™¨çš„å±æ€§
            
                struct itimerval {      // å®šæ—¶å™¨çš„ç»“æ„ä½“
                struct timeval it_interval;  // æ¯ä¸ªé˜¶æ®µçš„æ—¶é—´ï¼Œé—´éš”æ—¶é—´
                struct timeval it_value;     // å»¶è¿Ÿå¤šé•¿æ—¶é—´æ‰§è¡Œå®šæ—¶å™¨
                };

                struct timeval {        // æ—¶é—´çš„ç»“æ„ä½“
                    time_t      tv_sec;     //  ç§’æ•°     
                    suseconds_t tv_usec;    //  å¾®ç§’    
                };

            è¿‡10ç§’åï¼Œæ¯ä¸ª2ç§’å®šæ—¶ä¸€æ¬¡
           
            - old_value ï¼šè®°å½•ä¸Šä¸€æ¬¡çš„å®šæ—¶çš„æ—¶é—´å‚æ•°ï¼Œä¸€èˆ¬ä¸ä½¿ç”¨ï¼ŒæŒ‡å®šNULL
        
        - è¿”å›å€¼ï¼š
            æˆåŠŸ 0
            å¤±è´¥ -1 å¹¶è®¾ç½®é”™è¯¯å·
*/</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/time.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>

<span class="token comment">// è¿‡3ç§’ä»¥åï¼Œæ¯éš”2ç§’é’Ÿå®šæ—¶ä¸€æ¬¡</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">struct</span> <span class="token class-name">itimerval</span> new_value<span class="token punctuation">;</span>

    <span class="token comment">// è®¾ç½®é—´éš”çš„æ—¶é—´</span>
    new_value<span class="token punctuation">.</span>it_interval<span class="token punctuation">.</span>tv_sec <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    new_value<span class="token punctuation">.</span>it_interval<span class="token punctuation">.</span>tv_usec <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token comment">// è®¾ç½®å»¶è¿Ÿçš„æ—¶é—´,3ç§’ä¹‹åå¼€å§‹ç¬¬ä¸€æ¬¡å®šæ—¶</span>
    new_value<span class="token punctuation">.</span>it_value<span class="token punctuation">.</span>tv_sec <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
    new_value<span class="token punctuation">.</span>it_value<span class="token punctuation">.</span>tv_usec <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>


    <span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">setitimer</span><span class="token punctuation">(</span>ITIMER_REAL<span class="token punctuation">,</span> <span class="token operator">&amp;</span>new_value<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// éé˜»å¡çš„</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;å®šæ—¶å™¨å¼€å§‹äº†...\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;setitimer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br></div></div><h3 id="_23-signal-ä¿¡å·æ•æ‰å‡½æ•°-x264"><a href="#_23-signal-ä¿¡å·æ•æ‰å‡½æ•°-x264" class="header-anchor">#</a> 23-signal ä¿¡å·æ•æ‰å‡½æ•°_x264</h3> <h4 id="ã€1ã€signal-c"><a href="#ã€1ã€signal-c" class="header-anchor">#</a> ã€1ã€signal.c</h4> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">/*
    #include &lt;signal.h&gt;
    typedef void (*sighandler_t)(int);
    sighandler_t signal(int signum, sighandler_t handler);
        - åŠŸèƒ½ï¼šè®¾ç½®æŸä¸ªä¿¡å·çš„æ•æ‰è¡Œä¸º
        - å‚æ•°ï¼š
            - signum: è¦æ•æ‰çš„ä¿¡å·
            - handler: æ•æ‰åˆ°ä¿¡å·è¦å¦‚ä½•å¤„ç†
                - SIG_IGN ï¼š å¿½ç•¥ä¿¡å·
                - SIG_DFL ï¼š ä½¿ç”¨ä¿¡å·é»˜è®¤çš„è¡Œä¸º
                - å›è°ƒå‡½æ•° :  è¿™ä¸ªå‡½æ•°æ˜¯å†…æ ¸è°ƒç”¨ï¼Œç¨‹åºå‘˜åªè´Ÿè´£å†™ï¼Œæ•æ‰åˆ°ä¿¡å·åå¦‚ä½•å»å¤„ç†ä¿¡å·ã€‚
                å›è°ƒå‡½æ•°ï¼š
                    - éœ€è¦ç¨‹åºå‘˜å®ç°ï¼Œæå‰å‡†å¤‡å¥½çš„ï¼Œå‡½æ•°çš„ç±»å‹æ ¹æ®å®é™…éœ€æ±‚ï¼Œçœ‹å‡½æ•°æŒ‡é’ˆçš„å®šä¹‰
                    - ä¸æ˜¯ç¨‹åºå‘˜è°ƒç”¨ï¼Œè€Œæ˜¯å½“ä¿¡å·äº§ç”Ÿï¼Œç”±å†…æ ¸è°ƒç”¨
                    - å‡½æ•°æŒ‡é’ˆæ˜¯å®ç°å›è°ƒçš„æ‰‹æ®µï¼Œå‡½æ•°å®ç°ä¹‹åï¼Œå°†å‡½æ•°åæ”¾åˆ°å‡½æ•°æŒ‡é’ˆçš„ä½ç½®å°±å¯ä»¥äº†ã€‚

        - è¿”å›å€¼ï¼š
            æˆåŠŸï¼Œè¿”å›ä¸Šä¸€æ¬¡æ³¨å†Œçš„ä¿¡å·å¤„ç†å‡½æ•°çš„åœ°å€ã€‚ç¬¬ä¸€æ¬¡è°ƒç”¨è¿”å›NULL
            å¤±è´¥ï¼Œè¿”å›SIG_ERRï¼Œè®¾ç½®é”™è¯¯å·
            
    SIGKILL SIGSTOPä¸èƒ½è¢«æ•æ‰ï¼Œä¸èƒ½è¢«å¿½ç•¥ã€‚
*/</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/time.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;signal.h&gt;</span></span>

<span class="token keyword">void</span> <span class="token function">myalarm</span><span class="token punctuation">(</span><span class="token keyword">int</span> num<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;æ•æ‰åˆ°äº†ä¿¡å·çš„ç¼–å·æ˜¯ï¼š%d\n&quot;</span><span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;xxxxxxx\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// è¿‡3ç§’ä»¥åï¼Œæ¯éš”2ç§’é’Ÿå®šæ—¶ä¸€æ¬¡</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// æ³¨å†Œä¿¡å·æ•æ‰</span>
    <span class="token comment">// signal(SIGALRM, SIG_IGN);</span>
    <span class="token comment">// signal(SIGALRM, SIG_DFL);</span>
    <span class="token comment">// void (*sighandler_t)(int); å‡½æ•°æŒ‡é’ˆï¼Œintç±»å‹çš„å‚æ•°è¡¨ç¤ºæ•æ‰åˆ°çš„ä¿¡å·çš„å€¼ã€‚</span>
    <span class="token function">signal</span><span class="token punctuation">(</span>SIGALRM<span class="token punctuation">,</span> myalarm<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">struct</span> <span class="token class-name">itimerval</span> new_value<span class="token punctuation">;</span>

    <span class="token comment">// è®¾ç½®é—´éš”çš„æ—¶é—´</span>
    new_value<span class="token punctuation">.</span>it_interval<span class="token punctuation">.</span>tv_sec <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    new_value<span class="token punctuation">.</span>it_interval<span class="token punctuation">.</span>tv_usec <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token comment">// è®¾ç½®å»¶è¿Ÿçš„æ—¶é—´,3ç§’ä¹‹åå¼€å§‹ç¬¬ä¸€æ¬¡å®šæ—¶</span>
    new_value<span class="token punctuation">.</span>it_value<span class="token punctuation">.</span>tv_sec <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
    new_value<span class="token punctuation">.</span>it_value<span class="token punctuation">.</span>tv_usec <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">setitimer</span><span class="token punctuation">(</span>ITIMER_REAL<span class="token punctuation">,</span> <span class="token operator">&amp;</span>new_value<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// éé˜»å¡çš„</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;å®šæ—¶å™¨å¼€å§‹äº†...\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;setitimer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br></div></div><h3 id="_24-ä¿¡å·é›†åŠç›¸å…³å‡½æ•°-x264"><a href="#_24-ä¿¡å·é›†åŠç›¸å…³å‡½æ•°-x264" class="header-anchor">#</a> 24-ä¿¡å·é›†åŠç›¸å…³å‡½æ•°_x264</h3> <h3 id="_25-sigprocmask-å‡½æ•°ä½¿ç”¨-x264"><a href="#_25-sigprocmask-å‡½æ•°ä½¿ç”¨-x264" class="header-anchor">#</a> 25-sigprocmask å‡½æ•°ä½¿ç”¨_x264</h3> <h4 id="ã€1ã€sigprocmask-c"><a href="#ã€1ã€sigprocmask-c" class="header-anchor">#</a> ã€1ã€sigprocmask.c</h4> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">/*
    int sigprocmask(int how, const sigset_t *set, sigset_t *oldset);
        - åŠŸèƒ½ï¼šå°†è‡ªå®šä¹‰ä¿¡å·é›†ä¸­çš„æ•°æ®è®¾ç½®åˆ°å†…æ ¸ä¸­ï¼ˆè®¾ç½®é˜»å¡ï¼Œè§£é™¤é˜»å¡ï¼Œæ›¿æ¢ï¼‰
        - å‚æ•°ï¼š
            - how : å¦‚ä½•å¯¹å†…æ ¸é˜»å¡ä¿¡å·é›†è¿›è¡Œå¤„ç†
                SIG_BLOCK: å°†ç”¨æˆ·è®¾ç½®çš„é˜»å¡ä¿¡å·é›†æ·»åŠ åˆ°å†…æ ¸ä¸­ï¼Œå†…æ ¸ä¸­åŸæ¥çš„æ•°æ®ä¸å˜
                    å‡è®¾å†…æ ¸ä¸­é»˜è®¤çš„é˜»å¡ä¿¡å·é›†æ˜¯maskï¼Œ mask | set
                SIG_UNBLOCK: æ ¹æ®ç”¨æˆ·è®¾ç½®çš„æ•°æ®ï¼Œå¯¹å†…æ ¸ä¸­çš„æ•°æ®è¿›è¡Œè§£é™¤é˜»å¡
                    mask &amp;= ~set
                SIG_SETMASK:è¦†ç›–å†…æ ¸ä¸­åŸæ¥çš„å€¼
            
            - set ï¼šå·²ç»åˆå§‹åŒ–å¥½çš„ç”¨æˆ·è‡ªå®šä¹‰çš„ä¿¡å·é›†
            - oldset : ä¿å­˜è®¾ç½®ä¹‹å‰çš„å†…æ ¸ä¸­çš„é˜»å¡ä¿¡å·é›†çš„çŠ¶æ€ï¼Œå¯ä»¥æ˜¯ NULL
        - è¿”å›å€¼ï¼š
            æˆåŠŸï¼š0
            å¤±è´¥ï¼š-1
                è®¾ç½®é”™è¯¯å·ï¼šEFAULTã€EINVAL

    int sigpending(sigset_t *set);
        - åŠŸèƒ½ï¼šè·å–å†…æ ¸ä¸­çš„æœªå†³ä¿¡å·é›†
        - å‚æ•°ï¼šset,ä¼ å‡ºå‚æ•°ï¼Œä¿å­˜çš„æ˜¯å†…æ ¸ä¸­çš„æœªå†³ä¿¡å·é›†ä¸­çš„ä¿¡æ¯ã€‚
*/</span>

<span class="token comment">// ç¼–å†™ä¸€ä¸ªç¨‹åºï¼ŒæŠŠæ‰€æœ‰çš„å¸¸è§„ä¿¡å·ï¼ˆ1-31ï¼‰çš„æœªå†³çŠ¶æ€æ‰“å°åˆ°å±å¹•</span>
<span class="token comment">// è®¾ç½®æŸäº›ä¿¡å·æ˜¯é˜»å¡çš„ï¼Œé€šè¿‡é”®ç›˜äº§ç”Ÿè¿™äº›ä¿¡å·</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;signal.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// è®¾ç½®2ã€3å·ä¿¡å·é˜»å¡</span>
    <span class="token class-name">sigset_t</span> set<span class="token punctuation">;</span>
    <span class="token function">sigemptyset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>set<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// å°†2å·å’Œ3å·ä¿¡å·æ·»åŠ åˆ°ä¿¡å·é›†ä¸­</span>
    <span class="token function">sigaddset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>set<span class="token punctuation">,</span> SIGINT<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">sigaddset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>set<span class="token punctuation">,</span> SIGQUIT<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// ä¿®æ”¹å†…æ ¸ä¸­çš„é˜»å¡ä¿¡å·é›†</span>
    <span class="token function">sigprocmask</span><span class="token punctuation">(</span>SIG_BLOCK<span class="token punctuation">,</span> <span class="token operator">&amp;</span>set<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        num<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token comment">// è·å–å½“å‰çš„æœªå†³ä¿¡å·é›†çš„æ•°æ®</span>
        <span class="token class-name">sigset_t</span> pendingset<span class="token punctuation">;</span>
        <span class="token function">sigemptyset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pendingset<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">sigpending</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pendingset<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// éå†å‰32ä½</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">31</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">sigismember</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pendingset<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">sigismember</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pendingset<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;sigismember&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>num <span class="token operator">==</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// è§£é™¤é˜»å¡</span>
            <span class="token function">sigprocmask</span><span class="token punctuation">(</span>SIG_UNBLOCK<span class="token punctuation">,</span> <span class="token operator">&amp;</span>set<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>


    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br></div></div><h3 id="_26-sigaction-ä¿¡å·æ•æ‰å‡½æ•°-x264"><a href="#_26-sigaction-ä¿¡å·æ•æ‰å‡½æ•°-x264" class="header-anchor">#</a> 26-sigaction ä¿¡å·æ•æ‰å‡½æ•°_x264</h3> <h4 id="ã€ã€sigaction-c"><a href="#ã€ã€sigaction-c" class="header-anchor">#</a> ã€ã€sigaction.c</h4> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">/*
    #include &lt;signal.h&gt;
    int sigaction(int signum, const struct sigaction *act,
                            struct sigaction *oldact);

        - åŠŸèƒ½ï¼šæ£€æŸ¥æˆ–è€…æ”¹å˜ä¿¡å·çš„å¤„ç†ã€‚ä¿¡å·æ•æ‰
        - å‚æ•°ï¼š
            - signum : éœ€è¦æ•æ‰çš„ä¿¡å·çš„ç¼–å·æˆ–è€…å®å€¼ï¼ˆä¿¡å·çš„åç§°ï¼‰
            - act ï¼šæ•æ‰åˆ°ä¿¡å·ä¹‹åçš„å¤„ç†åŠ¨ä½œ
            - oldact : ä¸Šä¸€æ¬¡å¯¹ä¿¡å·æ•æ‰ç›¸å…³çš„è®¾ç½®ï¼Œä¸€èˆ¬ä¸ä½¿ç”¨ï¼Œä¼ é€’NULL
        - è¿”å›å€¼ï¼š
            æˆåŠŸ 0
            å¤±è´¥ -1

     struct sigaction {
        // å‡½æ•°æŒ‡é’ˆï¼ŒæŒ‡å‘çš„å‡½æ•°å°±æ˜¯ä¿¡å·æ•æ‰åˆ°ä¹‹åçš„å¤„ç†å‡½æ•°
        void     (*sa_handler)(int);
        // ä¸å¸¸ç”¨
        void     (*sa_sigaction)(int, siginfo_t *, void *);
        // ä¸´æ—¶é˜»å¡ä¿¡å·é›†ï¼Œåœ¨ä¿¡å·æ•æ‰å‡½æ•°æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¸´æ—¶é˜»å¡æŸäº›ä¿¡å·ã€‚
        sigset_t   sa_mask;
        // ä½¿ç”¨å“ªä¸€ä¸ªä¿¡å·å¤„ç†å¯¹æ•æ‰åˆ°çš„ä¿¡å·è¿›è¡Œå¤„ç†
        // è¿™ä¸ªå€¼å¯ä»¥æ˜¯0ï¼Œè¡¨ç¤ºä½¿ç”¨sa_handler,ä¹Ÿå¯ä»¥æ˜¯SA_SIGINFOè¡¨ç¤ºä½¿ç”¨sa_sigaction
        int        sa_flags;
        // è¢«åºŸå¼ƒæ‰äº†
        void     (*sa_restorer)(void);
    };

*/</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/time.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;signal.h&gt;</span></span>

<span class="token keyword">void</span> <span class="token function">myalarm</span><span class="token punctuation">(</span><span class="token keyword">int</span> num<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;æ•æ‰åˆ°äº†ä¿¡å·çš„ç¼–å·æ˜¯ï¼š%d\n&quot;</span><span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;xxxxxxx\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// è¿‡3ç§’ä»¥åï¼Œæ¯éš”2ç§’é’Ÿå®šæ—¶ä¸€æ¬¡</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">struct</span> <span class="token class-name">sigaction</span> act<span class="token punctuation">;</span>
    act<span class="token punctuation">.</span>sa_flags <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    act<span class="token punctuation">.</span>sa_handler <span class="token operator">=</span> myalarm<span class="token punctuation">;</span>
    <span class="token function">sigemptyset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>act<span class="token punctuation">.</span>sa_mask<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// æ¸…ç©ºä¸´æ—¶é˜»å¡ä¿¡å·é›†</span>
   
    <span class="token comment">// æ³¨å†Œä¿¡å·æ•æ‰</span>
    <span class="token function">sigaction</span><span class="token punctuation">(</span>SIGALRM<span class="token punctuation">,</span> <span class="token operator">&amp;</span>act<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">struct</span> <span class="token class-name">itimerval</span> new_value<span class="token punctuation">;</span>

    <span class="token comment">// è®¾ç½®é—´éš”çš„æ—¶é—´</span>
    new_value<span class="token punctuation">.</span>it_interval<span class="token punctuation">.</span>tv_sec <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    new_value<span class="token punctuation">.</span>it_interval<span class="token punctuation">.</span>tv_usec <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token comment">// è®¾ç½®å»¶è¿Ÿçš„æ—¶é—´,3ç§’ä¹‹åå¼€å§‹ç¬¬ä¸€æ¬¡å®šæ—¶</span>
    new_value<span class="token punctuation">.</span>it_value<span class="token punctuation">.</span>tv_sec <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
    new_value<span class="token punctuation">.</span>it_value<span class="token punctuation">.</span>tv_usec <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">setitimer</span><span class="token punctuation">(</span>ITIMER_REAL<span class="token punctuation">,</span> <span class="token operator">&amp;</span>new_value<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// éé˜»å¡çš„</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;å®šæ—¶å™¨å¼€å§‹äº†...\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;setitimer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// getchar();</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br></div></div><h3 id="_27-sigchildä¿¡å·"><a href="#_27-sigchildä¿¡å·" class="header-anchor">#</a> 27.SIGCHILDä¿¡å·</h3> <h4 id="ã€1ã€sigchld-c"><a href="#ã€1ã€sigchld-c" class="header-anchor">#</a> ã€1ã€sigchld.c</h4> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">/*
    SIGCHLDä¿¡å·äº§ç”Ÿçš„3ä¸ªæ¡ä»¶ï¼š
        1.å­è¿›ç¨‹ç»“æŸ
        2.å­è¿›ç¨‹æš‚åœäº†
        3.å­è¿›ç¨‹ç»§ç»­è¿è¡Œ
        éƒ½ä¼šç»™çˆ¶è¿›ç¨‹å‘é€è¯¥ä¿¡å·ï¼Œçˆ¶è¿›ç¨‹é»˜è®¤å¿½ç•¥è¯¥ä¿¡å·ã€‚
    
    ä½¿ç”¨SIGCHLDä¿¡å·è§£å†³åƒµå°¸è¿›ç¨‹çš„é—®é¢˜ã€‚
*/</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/stat.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;signal.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/wait.h&gt;</span></span>

<span class="token keyword">void</span> <span class="token function">myFun</span><span class="token punctuation">(</span><span class="token keyword">int</span> num<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;æ•æ‰åˆ°çš„ä¿¡å· ï¼š%d\n&quot;</span><span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// å›æ”¶å­è¿›ç¨‹PCBçš„èµ„æº</span>
    <span class="token comment">// while(1) {</span>
    <span class="token comment">//     wait(NULL); </span>
    <span class="token comment">// }</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">waitpid</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> WNOHANG<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;child die , pid = %d\n&quot;</span><span class="token punctuation">,</span> ret<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token comment">// è¯´æ˜è¿˜æœ‰å­è¿›ç¨‹æˆ–è€…</span>
           <span class="token keyword">break</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token comment">// æ²¡æœ‰å­è¿›ç¨‹</span>
           <span class="token keyword">break</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// æå‰è®¾ç½®å¥½é˜»å¡ä¿¡å·é›†ï¼Œé˜»å¡SIGCHLDï¼Œå› ä¸ºæœ‰å¯èƒ½å­è¿›ç¨‹å¾ˆå¿«ç»“æŸï¼Œçˆ¶è¿›ç¨‹è¿˜æ²¡æœ‰æ³¨å†Œå®Œä¿¡å·æ•æ‰</span>
    <span class="token class-name">sigset_t</span> set<span class="token punctuation">;</span>
    <span class="token function">sigemptyset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>set<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">sigaddset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>set<span class="token punctuation">,</span> SIGCHLD<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">sigprocmask</span><span class="token punctuation">(</span>SIG_BLOCK<span class="token punctuation">,</span> <span class="token operator">&amp;</span>set<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// åˆ›å»ºä¸€äº›å­è¿›ç¨‹</span>
    <span class="token class-name">pid_t</span> pid<span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        pid <span class="token operator">=</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>pid <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>pid <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// çˆ¶è¿›ç¨‹</span>

        <span class="token comment">// æ•æ‰å­è¿›ç¨‹æ­»äº¡æ—¶å‘é€çš„SIGCHLDä¿¡å·</span>
        <span class="token keyword">struct</span> <span class="token class-name">sigaction</span> act<span class="token punctuation">;</span>
        act<span class="token punctuation">.</span>sa_flags <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        act<span class="token punctuation">.</span>sa_handler <span class="token operator">=</span> myFun<span class="token punctuation">;</span>
        <span class="token function">sigemptyset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>act<span class="token punctuation">.</span>sa_mask<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">sigaction</span><span class="token punctuation">(</span>SIGCHLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>act<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// æ³¨å†Œå®Œä¿¡å·æ•æ‰ä»¥åï¼Œè§£é™¤é˜»å¡</span>
        <span class="token function">sigprocmask</span><span class="token punctuation">(</span>SIG_UNBLOCK<span class="token punctuation">,</span> <span class="token operator">&amp;</span>set<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;parent process pid : %d\n&quot;</span><span class="token punctuation">,</span> <span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span> pid <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// å­è¿›ç¨‹</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;child process pid : %d\n&quot;</span><span class="token punctuation">,</span> <span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br></div></div><h3 id="_28-å…±äº«å†…å­˜ï¼ˆ1ï¼‰"><a href="#_28-å…±äº«å†…å­˜ï¼ˆ1ï¼‰" class="header-anchor">#</a> 28.å…±äº«å†…å­˜ï¼ˆ1ï¼‰</h3> <h4 id="ã€1ã€å…±äº«å†…å­˜-c"><a href="#ã€1ã€å…±äº«å†…å­˜-c" class="header-anchor">#</a> ã€1ã€å…±äº«å†…å­˜.c</h4> <div class="language-c line-numbers-mode"><pre class="language-c"><code>å…±äº«å†…å­˜ç›¸å…³çš„å‡½æ•°
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/ipc.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/shm.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">shmget</span><span class="token punctuation">(</span><span class="token class-name">key_t</span> key<span class="token punctuation">,</span> <span class="token class-name">size_t</span> size<span class="token punctuation">,</span> <span class="token keyword">int</span> shmflg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">-</span> åŠŸèƒ½ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å…±äº«å†…å­˜æ®µï¼Œæˆ–è€…è·å–ä¸€ä¸ªæ—¢æœ‰çš„å…±äº«å†…å­˜æ®µçš„æ ‡è¯†ã€‚
        æ–°åˆ›å»ºçš„å†…å­˜æ®µä¸­çš„æ•°æ®éƒ½ä¼šè¢«åˆå§‹åŒ–ä¸º<span class="token number">0</span>
    <span class="token operator">-</span> å‚æ•°ï¼š
        <span class="token operator">-</span> key <span class="token operator">:</span> <span class="token class-name">key_t</span>ç±»å‹æ˜¯ä¸€ä¸ªæ•´å½¢ï¼Œé€šè¿‡è¿™ä¸ªæ‰¾åˆ°æˆ–è€…åˆ›å»ºä¸€ä¸ªå…±äº«å†…å­˜ã€‚
                ä¸€èˆ¬ä½¿ç”¨<span class="token number">16</span>è¿›åˆ¶è¡¨ç¤ºï¼Œé<span class="token number">0</span>å€¼
        <span class="token operator">-</span> size<span class="token operator">:</span> å…±äº«å†…å­˜çš„å¤§å°
        <span class="token operator">-</span> shmflg<span class="token operator">:</span> å±æ€§
            <span class="token operator">-</span> è®¿é—®æƒé™
            <span class="token operator">-</span> é™„åŠ å±æ€§ï¼šåˆ›å»º<span class="token operator">/</span>åˆ¤æ–­å…±äº«å†…å­˜æ˜¯ä¸æ˜¯å­˜åœ¨
                <span class="token operator">-</span> åˆ›å»ºï¼šIPC_CREAT
                <span class="token operator">-</span> åˆ¤æ–­å…±äº«å†…å­˜æ˜¯å¦å­˜åœ¨ï¼š IPC_EXCL <span class="token punctuation">,</span> éœ€è¦å’ŒIPC_CREATä¸€èµ·ä½¿ç”¨
                    IPC_CREAT <span class="token operator">|</span> IPC_EXCL <span class="token operator">|</span> <span class="token number">0664</span>
        <span class="token operator">-</span> è¿”å›å€¼ï¼š
            å¤±è´¥ï¼š<span class="token operator">-</span><span class="token number">1</span> å¹¶è®¾ç½®é”™è¯¯å·
            æˆåŠŸï¼š<span class="token operator">&gt;</span><span class="token number">0</span> è¿”å›å…±äº«å†…å­˜çš„å¼•ç”¨çš„IDï¼Œåé¢æ“ä½œå…±äº«å†…å­˜éƒ½æ˜¯é€šè¿‡è¿™ä¸ªå€¼ã€‚


<span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">shmat</span><span class="token punctuation">(</span><span class="token keyword">int</span> shmid<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>shmaddr<span class="token punctuation">,</span> <span class="token keyword">int</span> shmflg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">-</span> åŠŸèƒ½ï¼šå’Œå½“å‰çš„è¿›ç¨‹è¿›è¡Œå…³è”
    <span class="token operator">-</span> å‚æ•°ï¼š
        <span class="token operator">-</span> shmid <span class="token operator">:</span> å…±äº«å†…å­˜çš„æ ‡è¯†ï¼ˆIDï¼‰<span class="token punctuation">,</span>ç”±shmgetè¿”å›å€¼è·å–
        <span class="token operator">-</span> shmaddr<span class="token operator">:</span> ç”³è¯·çš„å…±äº«å†…å­˜çš„èµ·å§‹åœ°å€ï¼ŒæŒ‡å®š<span class="token constant">NULL</span>ï¼Œå†…æ ¸æŒ‡å®š
        <span class="token operator">-</span> shmflg <span class="token operator">:</span> å¯¹å…±äº«å†…å­˜çš„æ“ä½œ
            <span class="token operator">-</span> è¯» ï¼š SHM_RDONLY<span class="token punctuation">,</span> å¿…é¡»è¦æœ‰è¯»æƒé™
            <span class="token operator">-</span> è¯»å†™ï¼š <span class="token number">0</span>
    <span class="token operator">-</span> è¿”å›å€¼ï¼š
        æˆåŠŸï¼šè¿”å›å…±äº«å†…å­˜çš„é¦–ï¼ˆèµ·å§‹ï¼‰åœ°å€ã€‚  å¤±è´¥<span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token number">1</span>


<span class="token keyword">int</span> <span class="token function">shmdt</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>shmaddr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">-</span> åŠŸèƒ½ï¼šè§£é™¤å½“å‰è¿›ç¨‹å’Œå…±äº«å†…å­˜çš„å…³è”
    <span class="token operator">-</span> å‚æ•°ï¼š
        shmaddrï¼šå…±äº«å†…å­˜çš„é¦–åœ°å€
    <span class="token operator">-</span> è¿”å›å€¼ï¼šæˆåŠŸ <span class="token number">0</span>ï¼Œ å¤±è´¥ <span class="token operator">-</span><span class="token number">1</span>

<span class="token keyword">int</span> <span class="token function">shmctl</span><span class="token punctuation">(</span><span class="token keyword">int</span> shmid<span class="token punctuation">,</span> <span class="token keyword">int</span> cmd<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">shmid_ds</span> <span class="token operator">*</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">-</span> åŠŸèƒ½ï¼šå¯¹å…±äº«å†…å­˜è¿›è¡Œæ“ä½œã€‚åˆ é™¤å…±äº«å†…å­˜ï¼Œå…±äº«å†…å­˜è¦åˆ é™¤æ‰ä¼šæ¶ˆå¤±ï¼Œåˆ›å»ºå…±äº«å†…å­˜çš„è¿›è¡Œè¢«é”€æ¯äº†å¯¹å…±äº«å†…å­˜æ˜¯æ²¡æœ‰ä»»ä½•å½±å“ã€‚
    <span class="token operator">-</span> å‚æ•°ï¼š
        <span class="token operator">-</span> shmid<span class="token operator">:</span> å…±äº«å†…å­˜çš„ID
        <span class="token operator">-</span> cmd <span class="token operator">:</span> è¦åšçš„æ“ä½œ
            <span class="token operator">-</span> IPC_STAT <span class="token operator">:</span> è·å–å…±äº«å†…å­˜çš„å½“å‰çš„çŠ¶æ€
            <span class="token operator">-</span> IPC_SET <span class="token operator">:</span> è®¾ç½®å…±äº«å†…å­˜çš„çŠ¶æ€
            <span class="token operator">-</span> IPC_RMID<span class="token operator">:</span> æ ‡è®°å…±äº«å†…å­˜è¢«é”€æ¯
        <span class="token operator">-</span> bufï¼šéœ€è¦è®¾ç½®æˆ–è€…è·å–çš„å…±äº«å†…å­˜çš„å±æ€§ä¿¡æ¯
            <span class="token operator">-</span> IPC_STAT <span class="token operator">:</span> bufå­˜å‚¨æ•°æ®
            <span class="token operator">-</span> IPC_SET <span class="token operator">:</span> bufä¸­éœ€è¦åˆå§‹åŒ–æ•°æ®ï¼Œè®¾ç½®åˆ°å†…æ ¸ä¸­
            <span class="token operator">-</span> IPC_RMID <span class="token operator">:</span> æ²¡æœ‰ç”¨ï¼Œ<span class="token constant">NULL</span>

<span class="token class-name">key_t</span> <span class="token function">ftok</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>pathname<span class="token punctuation">,</span> <span class="token keyword">int</span> proj_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">-</span> åŠŸèƒ½ï¼šæ ¹æ®æŒ‡å®šçš„è·¯å¾„åï¼Œå’Œ<span class="token keyword">int</span>å€¼ï¼Œç”Ÿæˆä¸€ä¸ªå…±äº«å†…å­˜çš„key
    <span class="token operator">-</span> å‚æ•°ï¼š
        <span class="token operator">-</span> pathname<span class="token operator">:</span>æŒ‡å®šä¸€ä¸ªå­˜åœ¨çš„è·¯å¾„
            <span class="token operator">/</span>home<span class="token operator">/</span>nowcoder<span class="token operator">/</span>Linux<span class="token operator">/</span>a<span class="token punctuation">.</span>txt
            <span class="token operator">/</span> 
        <span class="token operator">-</span> proj_id<span class="token operator">:</span> <span class="token keyword">int</span>ç±»å‹çš„å€¼ï¼Œä½†æ˜¯è¿™ç³»ç»Ÿè°ƒç”¨åªä¼šä½¿ç”¨å…¶ä¸­çš„<span class="token number">1</span>ä¸ªå­—èŠ‚
                   èŒƒå›´ ï¼š <span class="token number">0</span><span class="token operator">-</span><span class="token number">255</span>  ä¸€èˆ¬æŒ‡å®šä¸€ä¸ªå­—ç¬¦ <span class="token string">'a'</span>


é—®é¢˜<span class="token number">1</span>ï¼šæ“ä½œç³»ç»Ÿå¦‚ä½•çŸ¥é“ä¸€å—å…±äº«å†…å­˜è¢«å¤šå°‘ä¸ªè¿›ç¨‹å…³è”ï¼Ÿ
    <span class="token operator">-</span> å…±äº«å†…å­˜ç»´æŠ¤äº†ä¸€ä¸ªç»“æ„ä½“<span class="token keyword">struct</span> <span class="token class-name">shmid_ds</span> è¿™ä¸ªç»“æ„ä½“ä¸­æœ‰ä¸€ä¸ªæˆå‘˜ shm_nattch
    <span class="token operator">-</span> shm_nattach è®°å½•äº†å…³è”çš„è¿›ç¨‹ä¸ªæ•°

é—®é¢˜<span class="token number">2</span>ï¼šå¯ä¸å¯ä»¥å¯¹å…±äº«å†…å­˜è¿›è¡Œå¤šæ¬¡åˆ é™¤ shmctl
    <span class="token operator">-</span> å¯ä»¥çš„
    <span class="token operator">-</span> å› ä¸ºshmctl æ ‡è®°åˆ é™¤å…±äº«å†…å­˜ï¼Œä¸æ˜¯ç›´æ¥åˆ é™¤
    <span class="token operator">-</span> ä»€ä¹ˆæ—¶å€™çœŸæ­£åˆ é™¤å‘¢<span class="token operator">?</span>
        å½“å’Œå…±äº«å†…å­˜å…³è”çš„è¿›ç¨‹æ•°ä¸º<span class="token number">0</span>çš„æ—¶å€™ï¼Œå°±çœŸæ­£è¢«åˆ é™¤
    <span class="token operator">-</span> å½“å…±äº«å†…å­˜çš„keyä¸º<span class="token number">0</span>çš„æ—¶å€™ï¼Œè¡¨ç¤ºå…±äº«å†…å­˜è¢«æ ‡è®°åˆ é™¤äº†
        å¦‚æœä¸€ä¸ªè¿›ç¨‹å’Œå…±äº«å†…å­˜å–æ¶ˆå…³è”ï¼Œé‚£ä¹ˆè¿™ä¸ªè¿›ç¨‹å°±ä¸èƒ½ç»§ç»­æ“ä½œè¿™ä¸ªå…±äº«å†…å­˜ã€‚ä¹Ÿä¸èƒ½è¿›è¡Œå…³è”ã€‚

    å…±äº«å†…å­˜å’Œå†…å­˜æ˜ å°„çš„åŒºåˆ«
    <span class="token number">1.</span>å…±äº«å†…å­˜å¯ä»¥ç›´æ¥åˆ›å»ºï¼Œå†…å­˜æ˜ å°„éœ€è¦ç£ç›˜æ–‡ä»¶ï¼ˆåŒ¿åæ˜ å°„é™¤å¤–ï¼‰
    <span class="token number">2.</span>å…±äº«å†…å­˜æ•ˆæœæ›´é«˜
    <span class="token number">3.</span>å†…å­˜
        æ‰€æœ‰çš„è¿›ç¨‹æ“ä½œçš„æ˜¯åŒä¸€å—å…±äº«å†…å­˜ã€‚
        å†…å­˜æ˜ å°„ï¼Œæ¯ä¸ªè¿›ç¨‹åœ¨è‡ªå·±çš„è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­æœ‰ä¸€ä¸ªç‹¬ç«‹çš„å†…å­˜ã€‚
    <span class="token number">4.</span>æ•°æ®å®‰å…¨
        <span class="token operator">-</span> è¿›ç¨‹çªç„¶é€€å‡º
            å…±äº«å†…å­˜è¿˜å­˜åœ¨
            å†…å­˜æ˜ å°„åŒºæ¶ˆå¤±
        <span class="token operator">-</span> è¿è¡Œè¿›ç¨‹çš„ç”µè„‘æ­»æœºï¼Œå®•æœºäº†
            æ•°æ®å­˜åœ¨åœ¨å…±äº«å†…å­˜ä¸­ï¼Œæ²¡æœ‰äº†
            å†…å­˜æ˜ å°„åŒºçš„æ•°æ® ï¼Œç”±äºç£ç›˜æ–‡ä»¶ä¸­çš„æ•°æ®è¿˜åœ¨ï¼Œæ‰€ä»¥å†…å­˜æ˜ å°„åŒºçš„æ•°æ®è¿˜å­˜åœ¨ã€‚

    <span class="token number">5.</span>ç”Ÿå‘½å‘¨æœŸ
        <span class="token operator">-</span> å†…å­˜æ˜ å°„åŒºï¼šè¿›ç¨‹é€€å‡ºï¼Œå†…å­˜æ˜ å°„åŒºé”€æ¯
        <span class="token operator">-</span> å…±äº«å†…å­˜ï¼šè¿›ç¨‹é€€å‡ºï¼Œå…±äº«å†…å­˜è¿˜åœ¨ï¼Œæ ‡è®°åˆ é™¤ï¼ˆæ‰€æœ‰çš„å…³è”çš„è¿›ç¨‹æ•°ä¸º<span class="token number">0</span>ï¼‰ï¼Œæˆ–è€…å…³æœº
            å¦‚æœä¸€ä¸ªè¿›ç¨‹é€€å‡ºï¼Œä¼šè‡ªåŠ¨å’Œå…±äº«å†…å­˜è¿›è¡Œå–æ¶ˆå…³è”ã€‚
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br></div></div><h3 id="_29-å…±äº«å†…å­˜ï¼ˆ2ï¼‰"><a href="#_29-å…±äº«å†…å­˜ï¼ˆ2ï¼‰" class="header-anchor">#</a> 29.å…±äº«å†…å­˜ï¼ˆ2ï¼‰</h3> <h4 id="ã€1ã€read-shm-c"><a href="#ã€1ã€read-shm-c" class="header-anchor">#</a> ã€1ã€read_shm.c</h4> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/ipc.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/shm.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    

    <span class="token comment">// 1.è·å–ä¸€ä¸ªå…±äº«å†…å­˜</span>
    <span class="token keyword">int</span> shmid <span class="token operator">=</span> <span class="token function">shmget</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> IPC_CREAT<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;shmid : %d\n&quot;</span><span class="token punctuation">,</span> shmid<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 2.å’Œå½“å‰è¿›ç¨‹è¿›è¡Œå…³è”</span>
    <span class="token keyword">void</span> <span class="token operator">*</span> ptr <span class="token operator">=</span> <span class="token function">shmat</span><span class="token punctuation">(</span>shmid<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 3.è¯»æ•°æ®</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s\n&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>ptr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;æŒ‰ä»»æ„é”®ç»§ç»­\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 4.è§£é™¤å…³è”</span>
    <span class="token function">shmdt</span><span class="token punctuation">(</span>ptr<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 5.åˆ é™¤å…±äº«å†…å­˜</span>
    <span class="token function">shmctl</span><span class="token punctuation">(</span>shmid<span class="token punctuation">,</span> IPC_RMID<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h4 id="ã€2ã€write-shm-c"><a href="#ã€2ã€write-shm-c" class="header-anchor">#</a> ã€2ã€write_shm.c</h4> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/ipc.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/shm.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    

    <span class="token comment">// 1.åˆ›å»ºä¸€ä¸ªå…±äº«å†…å­˜</span>
    <span class="token keyword">int</span> shmid <span class="token operator">=</span> <span class="token function">shmget</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">4096</span><span class="token punctuation">,</span> IPC_CREAT<span class="token operator">|</span><span class="token number">0664</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;shmid : %d\n&quot;</span><span class="token punctuation">,</span> shmid<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 2.å’Œå½“å‰è¿›ç¨‹è¿›è¡Œå…³è”</span>
    <span class="token keyword">void</span> <span class="token operator">*</span> ptr <span class="token operator">=</span> <span class="token function">shmat</span><span class="token punctuation">(</span>shmid<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">char</span> <span class="token operator">*</span> str <span class="token operator">=</span> <span class="token string">&quot;helloworld&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">// 3.å†™æ•°æ®</span>
    <span class="token function">memcpy</span><span class="token punctuation">(</span>ptr<span class="token punctuation">,</span> str<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;æŒ‰ä»»æ„é”®ç»§ç»­\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 4.è§£é™¤å…³è”</span>
    <span class="token function">shmdt</span><span class="token punctuation">(</span>ptr<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 5.åˆ é™¤å…±äº«å†…å­˜</span>
    <span class="token function">shmctl</span><span class="token punctuation">(</span>shmid<span class="token punctuation">,</span> IPC_RMID<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h3 id="_30-å®ˆæŠ¤è¿›ç¨‹ï¼ˆ1ï¼‰"><a href="#_30-å®ˆæŠ¤è¿›ç¨‹ï¼ˆ1ï¼‰" class="header-anchor">#</a> 30.å®ˆæŠ¤è¿›ç¨‹ï¼ˆ1ï¼‰</h3> <h3 id="_31-å®ˆæŠ¤è¿›ç¨‹ï¼ˆ2ï¼‰"><a href="#_31-å®ˆæŠ¤è¿›ç¨‹ï¼ˆ2ï¼‰" class="header-anchor">#</a> 31.å®ˆæŠ¤è¿›ç¨‹ï¼ˆ2ï¼‰</h3> <h4 id="ã€1ã€daemon-c"><a href="#ã€1ã€daemon-c" class="header-anchor">#</a> ã€1ã€daemon.c</h4> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">/*
    å†™ä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹ï¼Œæ¯éš”2sè·å–ä¸€ä¸‹ç³»ç»Ÿæ—¶é—´ï¼Œå°†è¿™ä¸ªæ—¶é—´å†™å…¥åˆ°ç£ç›˜æ–‡ä»¶ä¸­ã€‚
*/</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/stat.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/time.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;signal.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;time.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>

<span class="token keyword">void</span> <span class="token function">work</span><span class="token punctuation">(</span><span class="token keyword">int</span> num<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ•æ‰åˆ°ä¿¡å·ä¹‹åï¼Œè·å–ç³»ç»Ÿæ—¶é—´ï¼Œå†™å…¥ç£ç›˜æ–‡ä»¶</span>
    <span class="token class-name">time_t</span> tm <span class="token operator">=</span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">tm</span> <span class="token operator">*</span> loc <span class="token operator">=</span> <span class="token function">localtime</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>tm<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// char buf[1024];</span>

    <span class="token comment">// sprintf(buf, &quot;%d-%d-%d %d:%d:%d\n&quot;,loc-&gt;tm_year,loc-&gt;tm_mon</span>
    <span class="token comment">// ,loc-&gt;tm_mday, loc-&gt;tm_hour, loc-&gt;tm_min, loc-&gt;tm_sec);</span>

    <span class="token comment">// printf(&quot;%s\n&quot;, buf);</span>

    <span class="token keyword">char</span> <span class="token operator">*</span> str <span class="token operator">=</span> <span class="token function">asctime</span><span class="token punctuation">(</span>loc<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> fd <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;time.txt&quot;</span><span class="token punctuation">,</span> O_RDWR <span class="token operator">|</span> O_CREAT <span class="token operator">|</span> O_APPEND<span class="token punctuation">,</span> <span class="token number">0664</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">write</span><span class="token punctuation">(</span>fd <span class="token punctuation">,</span>str<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// 1.åˆ›å»ºå­è¿›ç¨‹ï¼Œé€€å‡ºçˆ¶è¿›ç¨‹</span>
    <span class="token class-name">pid_t</span> pid <span class="token operator">=</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>pid <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 2.å°†å­è¿›ç¨‹é‡æ–°åˆ›å»ºä¸€ä¸ªä¼šè¯</span>
    <span class="token function">setsid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 3.è®¾ç½®æ©ç </span>
    <span class="token function">umask</span><span class="token punctuation">(</span><span class="token number">022</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 4.æ›´æ”¹å·¥ä½œç›®å½•</span>
    <span class="token function">chdir</span><span class="token punctuation">(</span><span class="token string">&quot;/home/nowcoder/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 5. å…³é—­ã€é‡å®šå‘æ–‡ä»¶æè¿°ç¬¦</span>
    <span class="token keyword">int</span> fd <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;/dev/null&quot;</span><span class="token punctuation">,</span> O_RDWR<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">dup2</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> STDIN_FILENO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">dup2</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> STDOUT_FILENO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">dup2</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> STDERR_FILENO<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 6.ä¸šåŠ¡é€»è¾‘</span>

    <span class="token comment">// æ•æ‰å®šæ—¶ä¿¡å·</span>
    <span class="token keyword">struct</span> <span class="token class-name">sigaction</span> act<span class="token punctuation">;</span>
    act<span class="token punctuation">.</span>sa_flags <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    act<span class="token punctuation">.</span>sa_handler <span class="token operator">=</span> work<span class="token punctuation">;</span>
    <span class="token function">sigemptyset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>act<span class="token punctuation">.</span>sa_mask<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">sigaction</span><span class="token punctuation">(</span>SIGALRM<span class="token punctuation">,</span> <span class="token operator">&amp;</span>act<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">struct</span> <span class="token class-name">itimerval</span> val<span class="token punctuation">;</span>
    val<span class="token punctuation">.</span>it_value<span class="token punctuation">.</span>tv_sec <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    val<span class="token punctuation">.</span>it_value<span class="token punctuation">.</span>tv_usec <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    val<span class="token punctuation">.</span>it_interval<span class="token punctuation">.</span>tv_sec <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    val<span class="token punctuation">.</span>it_interval<span class="token punctuation">.</span>tv_usec <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token comment">// åˆ›å»ºå®šæ—¶å™¨</span>
    <span class="token function">setitimer</span><span class="token punctuation">(</span>ITIMER_REAL<span class="token punctuation">,</span> <span class="token operator">&amp;</span>val<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// ä¸è®©è¿›ç¨‹ç»“æŸ</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br></div></div></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.a81bfa9c.js" defer></script><script src="/assets/js/9.80747d9d.js" defer></script>
  </body>
</html>
